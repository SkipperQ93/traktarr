var Ee=Object.defineProperty;var _e=(t,e,r)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var h=(t,e,r)=>_e(t,typeof e!="symbol"?e+"":e,r);import{v as be}from"./uuid-C_lTrkZC.js";var R={Authenticate:"www-authenticate",Authorization:"Authorization",ContentType:"Content-Type",UserAgent:"User-Agent"},H={FormData:"multipart/form-data",Json:"application/json",FormUrlEncoded:"application/x-www-form-urlencoded"},xe=/[/\-\\^$*+?.()|[\]{}]/g,ke=()=>{throw new Error("Not implemented")},ae=class{constructor(t){h(this,"method");h(this,"url");h(this,"opts");h(this,"body");h(this,"init");h(this,"seed");h(this,"transform");h(this,"validate");h(this,"cached");h(this,"resolve");Object.keys(t).forEach(e=>{this[e]=t[e]}),this.init=this.init??{},this.opts={cache:!0,...t.opts},this.resolve=this.resolve??ke}get config(){return{method:this.method,url:this.url,opts:this.opts,init:this.init,body:this.body}}},s={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},ie=be,oe=class X extends Promise{constructor(){super(...arguments);h(this,"_controller",new AbortController);h(this,"_debug",!1);h(this,"id",`cancellable-promise-${ie()}`)}get signal(){return this._controller.signal}set signal(r){this._controller.signal.onabort=r.onabort}cancel(r){this.signal.aborted||(this._debug&&console.error("Promise was cancelled.",{id:this.id}),this._controller.abort(r))}then(...r){const i=super.then(...r);return i.cancel=this.cancel.bind(this),i.signal=this.signal,i}catch(r){const i=super.catch(r);return i.cancel=this.cancel.bind(this),i.signal=this.signal,i}finally(r){const i=super.finally(r);return i.cancel=this.cancel.bind(this),i.signal=this.signal,i}static isCancellable(r){return r instanceof X||"cancel"in r&&"signal"in r}static resolve(r){return X.from(Promise.resolve(r))}static from(r){if(X.isCancellable(r))return r;let i;const n=new X((y,b)=>{i=b,r.then(y).catch(b)}),p=()=>i(new DOMException("The operation was aborted.","AbortError"));return n.signal.addEventListener("abort",p),n}},Fe=class ne{constructor(e=!1){h(this,"_controller",new AbortController);h(this,"_debug");h(this,"id",`cancellable-promise-${ie()}`);this._debug=e}get signal(){return this._controller.signal}async fetch(e,r){try{return await fetch(e,{...r,signal:this._controller.signal})}catch(i){if(i instanceof Error&&(i==null?void 0:i.name)==="AbortError")return this._debug&&console.debug("Fetch request was cancelled.",{input:e,init:r,error:i}),Promise.reject(i);throw i}}static fetch(e,r){const i=new ne,n=i.fetch(e,r),p=["id","signal"],y=g=>{p.forEach(l=>{l in g||Object.defineProperty(g,l,{get:()=>i[l]})})},b=["then","catch","finally"],m=g=>{b.forEach(l=>{const u=g[l];g[l]=(...f)=>{const d=u.bind(g)(...f);return oe.isCancellable(d)||(y(d),m(d),d.cancel=(...v)=>i.cancel(...v)),d}})};return y(n),m(n),n.cancel=(...g)=>i.cancel(...g),n}cancel(e){this.signal.aborted||(this._debug&&console.debug("Fetch request was cancelled.",{id:this.id,reason:e}),this._controller.abort(e))}},Ge=t=>typeof t=="function",de=class{constructor(){h(this,"_observers",new Set)}_notify(t){this._observers.forEach(e=>e(t))}update(t){this._notify(t)}subscribe(t){return this._observers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){return t?this._observers.delete(t):(this._observers.clear(),!0)}},Pe=class extends de{constructor(e,r=!1){super();h(this,"_mutable");h(this,"_state");this._state=e,this._mutable=r}_notify(e,r=this._state){this._observers.forEach(i=>i(e,r))}get state(){return this._state}_update(e){this._mutable?this._state=e:this._state=Object.freeze(e)}update(e){const r=typeof this._state=="object"?structuredClone({...this._state}):this._state,i=Ge(e)?e(this._state):e;this._update(i),this._notify(i,r)}},le=(t=>(t[t.Silent=-1]="Silent",t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Info=2]="Info",t[t.Debug=3]="Debug",t[t.Trace=4]="Trace",t))(le||{}),V={ISO:"ISO",Date:"Date",Time:"Time",Local:"Local"},Se=(t,e=V.Time)=>{let r;return e===V.ISO?r=new Date().toISOString():e===V.Date?r=new Date().toLocaleDateString().split("T").at(0):e===V.Local?r=new Date().toLocaleString():r=new Date().toLocaleTimeString("en",{hour12:!1,timeZone:"UTC"}),t?`[${r} - ${t}]`:`[${r}]`},L={Debug:"#9e9e9e",Info:"#5bd4f9",Warn:"#f2c61a",Error:"#ff5549",Success:"#00ff00"},z={String:"%s",Float:"%f",DOM:"%o",Object:"%O"},Ae=(t,...e)=>{if(!(e!=null&&e.some(n=>typeof n=="string")))return e;let r="%c";const i=[`color: ${t}`];return e.forEach((n,p)=>{const y=p?" ":"";n instanceof Element?p<e.length-1&&(r+=`${y}${z.DOM}`):typeof n=="object"?p<e.length-1&&(r+=`${y}${z.Object}`):typeof n=="string"?r+=`${y}${z.String}`:typeof n=="number"&&(r+=`${y}${z.Float}`),i.push(n)}),i.unshift(r),i},Ce={trace:t=>t>=4,debug:t=>t>=3,info:t=>t>=2,warn:t=>t>=1,error:t=>t>=0},w;w=class{constructor({logger:e=console,debug:r=!1,proxy:i=Ce,logLevel:n=1,timeFormat:p=V.Time}={}){h(this,"_logger");h(this,"_proxy");h(this,"_timeFormat");h(this,"_debug");h(this,"_logLevel");h(this,"null",(...e)=>{this.isDebug&&console.debug("[ProxyLogger] - Log suppressed:",...e)});h(this,"color",{debug:(...e)=>this.debug(...w.colorize(L.Debug,...e)),info:(...e)=>this.info(...w.colorize(L.Info,...e)),warn:(...e)=>this.warn(...w.colorize(L.Warn,...e)),error:(...e)=>this.error(...w.colorize(L.Error,...e)),success:(...e)=>this.info(...w.colorize(L.Success,...e))});h(this,"time",{debug:(...e)=>this.debug(w.timestamp(void 0,this.timeFormat),...e),info:(...e)=>this.info(w.timestamp(void 0,this.timeFormat),...e),warn:(...e)=>this.warn(w.timestamp(void 0,this.timeFormat),...e),error:(...e)=>this.error(w.timestamp(void 0,this.timeFormat),...e),color:{debug:(...e)=>this.color.debug(w.timestamp(void 0,this.timeFormat),...e),info:(...e)=>this.color.info(w.timestamp(void 0,this.timeFormat),...e),warn:(...e)=>this.color.warn(w.timestamp(void 0,this.timeFormat),...e),error:(...e)=>this.color.error(w.timestamp(void 0,this.timeFormat),...e),success:(...e)=>this.color.success(w.timestamp(void 0,this.timeFormat),...e)}});h(this,"scope",e=>({debug:(...r)=>this.debug(w.timestamp(e,this.timeFormat),...r),info:(...r)=>this.info(w.timestamp(e,this.timeFormat),...r),warn:(...r)=>this.warn(w.timestamp(e,this.timeFormat),...r),error:(...r)=>this.error(w.timestamp(e,this.timeFormat),...r),color:{debug:(...r)=>this.color.debug(w.timestamp(e,this.timeFormat),...r),info:(...r)=>this.color.info(w.timestamp(e,this.timeFormat),...r),warn:(...r)=>this.color.warn(w.timestamp(e,this.timeFormat),...r),error:(...r)=>this.color.error(w.timestamp(e,this.timeFormat),...r),success:(...r)=>this.color.success(w.timestamp(e,this.timeFormat),...r)}}));h(this,"colored",{});this._logger=e,this._proxy=i,this._debug=r,this._logLevel=n,this._timeFormat=p}get timeFormat(){return typeof this._timeFormat=="function"?this._timeFormat():this._timeFormat}get isDebug(){return typeof this._debug=="function"?this._debug():this._debug}get logLevel(){return typeof this._logLevel=="function"?this._logLevel():this._logLevel}set logLevel(e){if(this._debug&&console.debug("[ProxyLogger] - Log level changed:",le[e]),typeof this._logLevel=="function")throw new Error("Cannot set log level when logLevel is a function");this._logLevel=e}get trace(){var e,r;return(r=(e=this._proxy)==null?void 0:e.trace)!=null&&r.call(e,this.logLevel)?this._logger.trace.bind(this._logger):this.null}get debug(){var e,r;return(r=(e=this._proxy)==null?void 0:e.debug)!=null&&r.call(e,this.logLevel)?this._logger.debug.bind(this._logger):this.null}get info(){var e,r;return(r=(e=this._proxy)==null?void 0:e.info)!=null&&r.call(e,this.logLevel)?this._logger.info.bind(this._logger):this.null}get warn(){var e,r;return(r=(e=this._proxy)==null?void 0:e.warn)!=null&&r.call(e,this.logLevel)?this._logger.warn.bind(this._logger):this.null}get error(){var e,r;return(r=(e=this._proxy)==null?void 0:e.error)!=null&&r.call(e,this.logLevel)?this._logger.error.bind(this._logger):this.null}},h(w,"logger",new w),h(w,"timestamp",Se),h(w,"colorize",Ae);var je={Day:24*60*60*1e3},ee=(t=8)=>{const e=new Uint8Array(t);return crypto.getRandomValues(e),Array.from(e).map(r=>r.toString(16).padStart(2,"0")).join("")},te=(t,e)=>{const r=t.clone();return Object.entries(t).forEach(([i,n])=>{typeof n!="function"&&(r[i]=n)}),r.cache=e,r},qe=(t,{key:e,evictionKey:r,cache:i,retention:n})=>{const p=l=>(l==null?void 0:l.retention)!==void 0?l.retention:typeof n=="number"?n:typeof n=="object"?n.retention??i.retention:i.retention,y=async({cacheKey:l,cacheOptions:u,evict:f})=>{if(u!=null&&u.force)return{};const d=await i.get(l);if(!d)return{};const v=p(u),T=d.cachedAt+v,E=(d.evictAt??T)>Date.now();let x;return(!d.cachedAt||!v||E)&&(x=te(d.value,{previous:d,current:d,isCache:!0,evict:f})),i.saveAccess&&(d.accessedAt=Date.now(),await i.set(l,d)),{cached:d,response:x}},b=({param:l,init:u},{cacheKey:f,cacheOptions:d,cached:v,evict:T})=>t(l,u).then(async E=>{const x={cachedAt:Date.now(),value:te(E),key:f};return(d!=null&&d.saveRetention||i.saveRetention)&&(x.evictAt=x.cachedAt+p(d)),await i.set(f,x),E.cache={previous:v,current:x,isCache:!1,evict:T},E}).catch(E=>{throw((d==null?void 0:d.evictOnError)??(typeof n=="object"?n==null?void 0:n.evictOnError:void 0)??i.evictOnError)&&T(),E}),m=(l,u,f)=>{const d=typeof e=="function"?e(l,u,f):e,v=()=>i.delete(d);let T;const E=oe.from(y({cacheKey:d,cacheOptions:f,evict:v})).then(({cached:j,response:Z})=>Z||(T=b({param:l,init:u},{cacheKey:d,cacheOptions:f,cached:j,evict:v}),T)),x=E.cancel;return E.cancel=j=>(T==null||T.cancel(j),x(j)),E};return Object.defineProperty(m,"evict",{value:async(l,u,f)=>{const d=r??e;if(!d)return;const v=typeof d=="function"?d(l,u,f):d;if(v.trim())return await i.clear(v),v}}),m},J=(t={},e)=>{const r={};return Object.entries(e).forEach(([i,n])=>{i in t&&(r[i]=n)}),Object.keys(t).forEach(i=>{if(t[i]===!0&&[void 0,null,""].includes(e[i]))throw new Error(`Missing mandatory body parameter: '${i}'`)}),r},De=(t={},e)=>{const r=J(t,e),i=new FormData;return Object.entries(r).forEach(([n,p])=>i.append(n,p)),i},Re=(t={},e)=>{const r=J(t,e),i=new URLSearchParams;return Object.entries(r).forEach(([n,p])=>i.append(n,p)),i},Oe=(t={},e)=>JSON.stringify(J(t,e)),ue=(t,e,r)=>{var g,l;const[i,n]=t.url.split("?");let p=i;i.includes(":")&&(p=i.split("/").map(u=>{var f,d,v;if(u.match(/^:/)){const T=u.substring(1),E=e[T];if((E===void 0||E==="")&&((v=(d=(f=t.opts)==null?void 0:f.parameters)==null?void 0:d.path)==null?void 0:v[T])===!0)throw Error(`Missing mandatory path parameter: '${T}'`);return E??""}return u}).filter(u=>![void 0,null,""].includes(u)).join("/"));const y=new URL(p,r),b=new URLSearchParams(n),m=(l=(g=t.opts)==null?void 0:g.parameters)==null?void 0:l.query;return m&&Object.keys(m).forEach(u=>{b.has(u)||b.set(u,"")}),b.forEach((u,f)=>{var v,T,E;const d=e[f]??u;if(![void 0,null,""].includes(d))y.searchParams.set(f,typeof d=="object"?JSON.stringify(d):d);else if(((E=(T=(v=t.opts)==null?void 0:v.parameters)==null?void 0:T.query)==null?void 0:E[f])===!0)throw Error(`Missing mandatory query parameter: '${f}'`)}),y},Ue=(t,e,r=!1)=>e.url.startsWith(t)?e:r?(e.url=`${t}${e.url}`,e):{...e,url:`${t}${e.url}`},he=(t,e,r=!1)=>{if(!e.corsPrefix)return t;const i=`/${e.corsPrefix}`;return Ue(i,t,r)},$e=t=>t instanceof ae,Ie=(t=je.Day)=>{const e=new Map;return e.retention=t,e.evictOnError=!0,e},Le=class{constructor({cacheStore:t,...e},r,i){h(this,"_settings");h(this,"_cache");h(this,"_authentication");h(this,"_callListeners");var n;this._settings=e,this._authentication=new Pe(r),this._callListeners=new de,this._cache=t??Ie((n=e.cache)==null?void 0:n.retention),Object.assign(this,this.bindToEndpoint(i))}get settings(){return this._settings.corsProxy?{...this._settings,endpoint:this._settings.corsProxy}:this._settings}get auth(){return this._authentication.state}updateAuth(t){this._authentication.update(t)}onAuthChange(t){return this._authentication.subscribe(t)}onCall(t){return this._callListeners.subscribe(t)}unsubscribe(t){return{auth:this._authentication.unsubscribe(t),call:this._callListeners.unsubscribe(t)}}clearCache(t,e=!0){var r,i;return t&&e?(r=this._cache)==null?void 0:r.delete(t):(i=this._cache)==null?void 0:i.clear(t)}bindToEndpoint(t){const e={...t};return Object.entries(e).forEach(([r,i])=>{var n;if($e(i)){const p=(m,g)=>this._call(i,m,g),y=qe(p,{key:(m,g,l)=>{var x,j;const{template:u=i,params:f=m,init:d=g}=((x=this._transform)==null?void 0:x.call(this,i,m,g))??{},v={...u.seed,...f},T=((j=u.transform)==null?void 0:j.call(u,v))??v,E=JSON.stringify({template:i.config,param:T,init:d});return l!=null&&l.cacheKey&&typeof l.cacheKey=="function"?l.cacheKey(E):E},cache:this._cache,retention:(n=i.opts)==null?void 0:n.cache,evictionKey:`{"template":${JSON.stringify(i.config).replace(xe,"\\$&")}`}),b=(m={})=>{var d,v,T;const{template:g=i,params:l=m}=((d=this._transform)==null?void 0:d.call(this,i,m))??{},u={...g.seed,...l},f=((v=g.transform)==null?void 0:v.call(g,u))??u;return(T=i.validate)==null||T.call(i,f),this._parseUrl(g,f)};Object.entries(i).forEach(([m,g])=>{var l,u,f;m==="cached"?(l=i.opts)!=null&&l.cache&&Object.defineProperty(p,"cached",{value:y}):m==="resolve"?(Object.defineProperty(p,"resolve",{value:b}),(u=i.opts)!=null&&u.cache&&Object.defineProperty(y,"resolve",{value:b})):(Object.defineProperty(p,m,{value:g}),(f=i.opts)!=null&&f.cache&&Object.defineProperty(y,m,{value:g}))}),e[r]=p}else e[r]=this.bindToEndpoint(i)}),e}_call(t,e={},r){var l,u,f,d,v;const{template:i=t,params:n=e,init:p=r}=((l=this._transform)==null?void 0:l.call(this,t,e,r))??{},y={...i.seed,...n},b=((u=i.transform)==null?void 0:u.call(i,y))??y;(f=i.validate)==null||f.call(i,b);const m={input:this._parseUrl(i,b).toString(),init:{...i.init,...p,method:i.method,headers:{...(d=i.init)==null?void 0:d.headers,...(v=this._parseHeaders)==null?void 0:v.call(this,i,b),...p==null?void 0:p.headers}}};i.method!==s.GET&&i.body&&(m.init.body=this._parseBody(i.body,y,m));const g=Fe.fetch(m.input,m.init).then(T=>{var E;return((E=this._parseResponse)==null?void 0:E.call(this,T,m,i))??T});return this._callListeners.update({request:m,query:g}),g}_parseUrl(t,e){return he(t,this.settings),ue(t,e,this.settings.endpoint)}_parseBody(t,e,r){var i,n,p,y;return((n=(i=r==null?void 0:r.init)==null?void 0:i.headers)==null?void 0:n[R.ContentType])===H.FormUrlEncoded?Re(t,e):((y=(p=r==null?void 0:r.init)==null?void 0:p.headers)==null?void 0:y[R.ContentType])===H.FormData?De(t,e):Oe(t,e)}},o={Full:"full",Metadata:"metadata",GuestStars:"guest_stars",Episodes:"episodes",NoSeasons:"noseasons",Vip:"vip",Comments:"comments",Images:"images",All:"all"},a=class extends ae{},c={RetryAfter:"Retry-After",XRatelimit:"X-Ratelimit",XUpgradeURL:"X-Upgrade-URL",XVipUser:"X-VIP-User",XAccountLimit:"X-Account-Limit",XPaginationPage:"X-Pagination-Page",XPaginationLimit:"X-Pagination-Limit",XPaginationPageCount:"X-Pagination-Page-Count",XPaginationItemCount:"X-Pagination-Item-Count",TraktApiVersion:"trakt-api-version",TraktApiKey:"trakt-api-key",XStartDate:"X-Start-Date",XEndDate:"X-End-Date",XSortBy:"X-Sort-By",XSortHow:"X-Sort-How",XAppliedSortBy:"X-Applied-Sort-By",XAppliedSortHow:"X-Applied-Sort-How",UserAgent:R.UserAgent,ContentType:R.ContentType,Authorization:R.Authorization,Authenticate:R.Authenticate},pe={oAuth:{authorize:new a({method:s.GET,url:"/oauth/authorize?response_type=code&client_id=&redirect_uri=&state=&signup=&prompt=",init:{redirect:"manual",credentials:"omit"},opts:{cache:!1,parameters:{query:{response_type:!0,client_id:!0,redirect_uri:!0,state:!1,signup:!1,prompt:!1}}},transform:t=>({...t,prompt:t.prompt?"login":t.prompt})}),token:{code:new a({method:s.POST,url:"/oauth/token",opts:{cache:!1},body:{code:!0,client_id:!0,client_secret:!0,redirect_uri:!0,grant_type:!0}}),refresh:new a({method:s.POST,url:"/oauth/token",opts:{cache:!1},body:{refresh_token:!0,client_id:!0,client_secret:!0,redirect_uri:!0,grant_type:!0}})},revoke:new a({method:s.POST,url:"/oauth/revoke",opts:{cache:!1},body:{token:!0,client_id:!0,client_secret:!0}})},device:{code:new a({method:s.POST,url:"/oauth/device/code",opts:{cache:!1},body:{client_id:!0}}),token:new a({method:s.POST,url:"/oauth/device/token",opts:{cache:!1},body:{code:!0,client_id:!0,client_secret:!0}})}},Xe={authentication:pe},Ve={ReturningSeries:"returning series",Continuing:"continuing",InProduction:"in production",Planned:"planned",Upcoming:"upcoming",Pilot:"pilot",Canceled:"canceled",Ended:"ended"},Me=Object.values(Ve),Ne={Standard:"standard",SeriesPremiere:"series_premiere",SeasonPremiere:"season_premiere",MidSeasonPremiere:"mid_season_premiere",MidSeasonFinale:"mid_season_finale",SeasonFinale:"season_finale",SeriesFinale:"series_finale"},ze=Object.values(Ne),Be=/^\d+-\d+$/,He=/^(10|\d)\.\d-(10|\d)\.\d$/,Je=/^(100|\d{0,2})-(100|\d{0,2})$/,We=/^(100000|\d{0,5})-(100000|\d{0,5})$/,Ke=/^(300000|[1-2]?\d{0,5})-(300000|[1-2]?\d{0,5})$/,Ye=/^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])(T([01]\d|2[0-3]):[0-5]\d:[0-5]\d(\.\d+)?(Z|[+-]\d{2}:[0-5]\d)?)?$/,Qe=/^(\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/,_={Success:200,PostSuccess:201,DeleteSuccess:204,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,MethodNotFound:405,Conflict:409,Expired:410,PreconditionFailed:412,Denied:418,AccountLimitExceeded:420,UnprocessableEntity:422,LockedUserAccount:423,VIPOnly:426,RateLimitExceeded:429,ServerError:500,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,CloudflareError:520,WebServerIsDown:521,TCPError:522},Ze={[_.Success]:"Success",[_.PostSuccess]:"Success - new resource created (POST)",[_.DeleteSuccess]:"Success - no content to return (DELETE)",[_.BadRequest]:"Bad Request - request couldn't be parsed",[_.Unauthorized]:"Unauthorized - OAuth must be provided",[_.Forbidden]:"Forbidden - invalid API key or unapproved app",[_.NotFound]:"Not Found - method exists, but no record found",[_.MethodNotFound]:"Method Not Found - method doesn't exist",[_.Conflict]:"Conflict - resource already created",[_.Expired]:"Expired - the tokens have expired, restart the process",[_.PreconditionFailed]:"Precondition Failed - use application/json content type",[_.Denied]:"Denied - user explicitly denied this code",[_.AccountLimitExceeded]:"Account Limit Exceeded - list count, item count, etc",[_.UnprocessableEntity]:"Unprocessable Entity - validation errors",[_.LockedUserAccount]:"Locked User Account - have the user contact support",[_.VIPOnly]:"VIP Only - user must upgrade to VIP",[_.RateLimitExceeded]:"Rate Limit Exceeded",[_.ServerError]:"Server Error - please open a support ticket",[_.BadGateway]:"Service Unavailable - Bad Gateway - server overloaded (try again in 30s)",[_.ServiceUnavailable]:"Service Unavailable - server overloaded (try again in 30s)",[_.GatewayTimeout]:"Service Unavailable - Gateway Timeout - server overloaded (try again in 30s)",[_.CloudflareError]:"Service Unavailable - Cloudflare error",[_.WebServerIsDown]:"Service Unavailable - Web server is down - Cloudflare error",[_.TCPError]:"Service Unavailable - Cloudflare error"},S={TraktApiError:"TraktApiError",TraktApiResponseError:"TraktApiResponseError",TraktValidationError:"TraktValidationError",TraktFilterError:"TraktFilterError",TraktUnauthorizedError:"TraktUnauthorizedError",TraktRateLimitError:"TraktRateLimitError",TraktInvalidParameterError:"TraktInvalidParameterError",TraktPollingExpiredError:"TraktPollingExpiredError",TraktPollingCancelledError:"TraktPollingCancelledError",TraktExpiredTokenError:"TraktExpiredTokenError",TraktInvalidCsrfError:"TraktInvalidCsrfError"},W=class extends Error{constructor(e,r){super(e);h(this,"error");this.name=S.TraktApiError,this.error=r}},ce=class extends Error{constructor(t){super(t),this.name=S.TraktValidationError}},P=class extends Error{constructor(t){super(t),this.name=S.TraktFilterError}},et=class extends W{constructor(t,e){super(t,e),this.name=S.TraktUnauthorizedError}},tt=class extends W{constructor(t,e){super(t,e),this.name=S.TraktRateLimitError}},O=class extends Error{constructor(t){super(t),this.name=S.TraktInvalidParameterError}},rt=class extends Error{constructor(t="Polling expired."){super(t),this.name=S.TraktPollingExpiredError}},st=class extends Error{constructor(t="Polling cancelled."){super(t),this.name=S.TraktPollingCancelledError}},at=class extends Error{constructor(t){super(t),this.name=S.TraktExpiredTokenError}},it=class extends Error{constructor({state:e,expected:r}={}){super(`Invalid CSRF (State): expected '${r}', but received ${e}`);h(this,"state");h(this,"expected");this.name=S.TraktInvalidCsrfError,this.state=e,this.expected=r}},me=class extends Error{constructor(e,r){super(e);h(this,"response");this.name=S.TraktApiResponseError,this.response=r}},ot=t=>{if(t instanceof Response){const e=Ze[t.status]||t.statusText;return new me(e,t)}return t},A={Query:"query",Years:"years",Runtimes:"runtimes",Genres:"genres",Languages:"languages",Countries:"countries",StudioIds:"studio_ids"},I=Object.values(A),C={Ratings:"ratings",Votes:"votes",TmdbVotes:"tmdb_votes",ImdbVotes:"imdb_votes",TmdbRatings:"tmdb_ratings",ImdbRatings:"imdb_ratings"},K=Object.values(C),B={...C,RtMeters:"rt_meters",RtUserMeters:"rt_user_meters",Metascores:"metascores"},nt=Object.values(B),fe={Certifications:"certifications"},dt=[...I,...nt,...Object.values(fe)],Y={Certifications:"certifications",NetworkIds:"network_ids",Status:"status"},ge=[...I,...K,...Object.values(Y)],Q={Certifications:"certifications",NetworkIds:"network_ids",EpisodeTypes:"episode_types"},lt=[...I,...K,...Object.values(Q)],ut={...A,...C,...fe,...Y,...Q},ht=Object.values(ut),pt=t=>ht.includes(t),M={common:(t,e,r=!1)=>{if(Array.isArray(e)&&[A.Query,A.Years,A.Runtimes].some(n=>n===t)){if(r)throw new P(`Filter '${t}' doesn't support multiple values.`);return!1}if(t===A.Runtimes&&!Be.test(e.toString())){if(r)throw new P(`Filter '${t}' should be dash separated digits, i.e. \\d+-\\d+`);return!1}const i=Array.isArray(e)?e:[e];if(i.some(n=>n.toString().length>4)&&t===A.Years){if(r)throw new P(`Filter '${t}' needs to be a 4 digit value.`);return!1}if(i.some(n=>n.toString().length>2)&&[A.Languages,A.Countries].some(n=>n===t)){if(r)throw new P(`Filter '${t}' needs to be a 2 digit value.`);return!1}return!0},rating:(t,e,r=!1)=>{if(Array.isArray(e)){if(r)throw new P(`Filter '${t}' doesn't support multiple values.`);return!1}switch(t){case C.Ratings:case B.RtMeters:case B.RtUserMeters:case B.Metascores:if(!Je.test(e.toString())){if(r)throw new P(`Filter '${t}' should be a range between 0 and 100.`);return!1}break;case C.Votes:case C.TmdbVotes:if(!We.test(e.toString())){if(r)throw new P(`Filter '${t}' should be a range between 0 and 100 0000.`);return!1}break;case C.ImdbVotes:if(!Ke.test(e.toString())){if(r)throw new P(`Filter '${t}' should be a range between 0 and 300 0000.`);return!1}break;case C.TmdbRatings:case C.ImdbRatings:if(!He.test(e.toString())){if(r)throw new P(`Filter '${t}' should be a range between 0.0 and 10.0.`);return!1}break}return!0},shows:(t,e,r=!1)=>{const i=Array.isArray(e)?e:[e];if(t===Y.Status&&!i.some(n=>Me.includes(n.toString()))){if(r)throw new P(`Filter '${t}' is invalid: unknown status '${e}'.`);return!1}return!0},episodes:(t,e,r=!1)=>{const i=Array.isArray(e)?e:[e];if(t===Q.EpisodeTypes&&!i.some(n=>ze.includes(n.toString()))){if(r)throw new P(`Filter '${t}' is invalid: unknown episode type '${e}'.`);return!1}return!0},validate:(t,e,r=!1)=>I.includes(t)?M.common(t,e,r):K.includes(t)?M.rating(t,e,r):ge.includes(t)?M.shows(t,e,r):lt.includes(t)?M.episodes(t,e,r):!0},we=t=>{if(t.type==="opaqueredirect")return t;if(!t.ok||t.status>=400)throw ot(t);return t},re=(t,e={})=>({...e,refresh_token:t.refresh_token,access_token:t.access_token,created:t.created_at*1e3,expires:(t.created_at+t.expires_in)*1e3}),ct=(t,e)=>{var i;we(t);const r=t;if((i=e==null?void 0:e.opts)!=null&&i.pagination&&(r.pagination={itemCount:null,pageCount:1,limit:null,page:1}),(t.headers.has(c.XPaginationItemCount)||t.headers.has(c.XPaginationPageCount)||t.headers.has(c.XPaginationLimit)||t.headers.has(c.XPaginationPage))&&(r.pagination||(r.pagination={itemCount:null,pageCount:1,limit:null,page:1}),r.pagination.itemCount=Number(t.headers.get(c.XPaginationItemCount)),r.pagination.pageCount=Number(t.headers.get(c.XPaginationPageCount)),r.pagination.limit=Number(t.headers.get(c.XPaginationLimit)),r.pagination.page=Number(t.headers.get(c.XPaginationPage))),(t.headers.has(c.XSortBy)||t.headers.has(c.XSortHow))&&(r.sort={by:t.headers.get(c.XSortBy),how:t.headers.get(c.XSortHow)}),(t.headers.has(c.XAppliedSortBy)||t.headers.has(c.XAppliedSortHow))&&(r.appliedSort={by:t.headers.get(c.XAppliedSortBy),how:t.headers.get(c.XAppliedSortHow)}),(t.headers.has(c.XStartDate)||t.headers.has(c.XEndDate))&&(r.interval={start:t.headers.get(c.XStartDate),end:t.headers.get(c.XEndDate)}),(t.headers.has(c.XUpgradeURL)||t.headers.has(c.XVipUser)||t.headers.has(c.XAccountLimit))&&(r.vip={url:t.headers.get(c.XUpgradeURL),user:t.headers.get(c.XVipUser),limit:t.headers.get(c.XAccountLimit)}),t.headers.has(c.XRatelimit)||t.headers.has(c.RetryAfter)){if(r.limit={},t.headers.has(c.XRatelimit))try{r.limit.rate=JSON.parse(t.headers.get(c.XRatelimit))}catch(n){console.warn("Failed to parse rate limit",t.headers.get(c.XRatelimit),n)}t.headers.has(c.RetryAfter)&&(r.limit.retry=Number(t.headers.get(c.RetryAfter)))}return r},mt=class extends Le{constructor(t,e={},r={}){super(t,e,r)}_parseHeaders(t){var r,i;const e={[c.UserAgent]:this.settings.useragent,[c.ContentType]:H.Json,[c.TraktApiVersion]:"2",[c.TraktApiKey]:this.settings.client_id};if(((r=t.opts)==null?void 0:r.auth)===!0&&!this.auth.access_token)throw new O("OAuth required: access_token is missing");if((i=t.opts)!=null&&i.auth&&this.auth.access_token)if(this.auth.expires!==void 0&&this.auth.expires>Date.now())e[c.Authorization]=`Bearer ${this.auth.access_token}`;else throw new at("OAuth required: access_token has expired");return e}_parseUrl(t,e){var p,y,b,m,g;const r=he(t,this.settings),i=ue(r,e,this.settings.endpoint),n=i.searchParams;if((y=(p=r.opts)==null?void 0:p.filters)!=null&&y.length&&e.filters&&Object.entries(e.filters).forEach(([l,u])=>{var f,d;if(!pt(l)||!((d=(f=r.opts)==null?void 0:f.filters)!=null&&d.includes(l)))throw new P(`Filter is not supported: '${l}'`);if(!M.validate(l,u,!0))throw new ce(`Filter '${l}' is invalid: '${u}'`);n.set(l,`${u}`)}),(b=r.opts)!=null&&b.pagination&&e.pagination&&(e.pagination.page&&n.set("page",`${e.pagination.page}`),e.pagination.limit&&n.set("limit",`${e.pagination.limit}`)),(g=(m=r.opts)==null?void 0:m.extended)!=null&&g.length&&e.extended){const l=r.opts.extended;if((Array.isArray(e.extended)?e.extended:[e.extended]).some(f=>!l.includes(f)))throw new O(`Invalid value '${e.extended}', extended should be '${r.opts.extended.join(", ")}'`);n.set("extended",`${e.extended}`)}return i}_parseResponse(t,e,r){return ct(t,r)}},ye=t=>t&&typeof t=="object"&&"status"in t,se=t=>ye(t)?t.status===401?new et(t.headers.get(c.Authenticate)??t.statusText,t):t.status===429?new tt(t.headers.get(c.XRatelimit)??t.statusText,t):t:t,qt=class extends mt{constructor(e,r={},i=Xe){super(e,r,i);h(this,"polling");h(this,"poll")}get isStaging(){return this.settings.endpoint.includes("staging")}get redirectUri(){return this.settings.redirect_uri}async _exchange(e){const r={client_id:this.settings.client_id,client_secret:this.settings.client_secret,redirect_uri:this.settings.redirect_uri,grant_type:"code"in e?"authorization_code":"refresh_token",...e};try{let i;"code"in r?i=await this.authentication.oAuth.token.code(r):i=await this.authentication.oAuth.token.refresh(r);const n=await i.json();return this.updateAuth(p=>re(n,p)),this.auth}catch(i){throw se(i)}}async _revoke(e={}){if(!e&&!this.auth.access_token)throw new O("No access token found.");const r={token:this.auth.access_token,client_id:this.settings.client_id,client_secret:this.settings.client_secret,...e},i=await this.authentication.oAuth.revoke(r);return we(i),i}async _device(e){try{let r;return e?r=await this.authentication.device.token({client_id:this.settings.client_id,client_secret:this.settings.client_secret,code:e}):r=await this.authentication.device.code({client_id:this.settings.client_id}),await r.json()}catch(r){throw se(r)}}_clearPolling(){this.polling!==void 0&&(clearInterval(this.polling),this.polling=void 0)}_clearPoll(){this.poll=void 0}async _devicePolling(e=this.poll,r){if(this.polling!==void 0){if(!(e!=null&&e.device_code))throw new O("No device code found.");if(r<=Date.now())throw new rt;try{const i=await this._device(e.device_code);return this.updateAuth(n=>re(i,n)),this.auth}catch(i){if(!ye(i))throw i;if(i.status!==400)throw new W(i.statusText,i);return console.info("Polling in progress..."),null}}}async getDeviceCode(){try{return this.poll=await this._device(null),this.poll}catch(e){throw this._clearPoll(),e}}pollWithDeviceCode(e=this.poll){if(!(e!=null&&e.device_code))throw new O("No device code found.");this.polling&&(this._clearPolling(),console.warn("Polling already in progress, cancelling previous one..."));const r=Date.now()+e.expires_in*1e3;let i;const n=new Promise((p,y)=>{i=y;const b=async()=>{try{const m=await this._devicePolling(e,r);if(!m)return;p(m)}catch(m){if(m instanceof me){if(m.response.status===400)return;if(m.response.status===429){console.warn("Polling too quickly, rate limit exceeded");return}}y(m)}this._clearPolling(),this._clearPoll()};this.polling=setInterval(b,e.interval*1e3)});return n.cancel=()=>{this._clearPolling(),this._clearPoll(),console.warn("Polling cancelled"),i(new st)},n}redirectToAuthentication({redirect:e,redirect_uri:r,...i}={}){this.updateAuth(p=>({...p,state:i.state??ee()}));const n={credentials:"omit"};return e&&(n.redirect=e),this.authentication.oAuth.authorize({response_type:"code",client_id:this.settings.client_id,redirect_uri:r??this.settings.redirect_uri,state:this.auth.state,...i},n)}redirectToAuthenticationUrl({redirect_uri:e,...r}={}){return this.updateAuth(i=>({...i,state:r.state??ee()})),this.authentication.oAuth.authorize.resolve({response_type:"code",client_id:this.settings.client_id,redirect_uri:e??this.settings.redirect_uri,state:this.auth.state,...r}).toString()}exchangeCodeForToken(e,r){if(r&&r!==this.auth.state)throw new it({state:r,expected:this.auth.state});return this._exchange({code:e})}refreshToken(e=this.auth.refresh_token){if(!e)throw new O("No refresh token found.");return this._exchange({refresh_token:e})}async revokeAuthentication(){if(!this.auth.access_token)throw Error("No access token found.");this.auth.expires!==void 0&&this.auth.expires>Date.now()&&await this._revoke(),this.updateAuth({})}async importAuthentication(e={}){return e.expires!==void 0&&e.expires<Date.now()?this.refreshToken(e.refresh_token):(this.updateAuth(e),this.auth)}},ft={lastActivities:new a({method:s.GET,url:"/sync/last_activities",opts:{auth:!0}}),playback:{get:new a({method:s.GET,url:"/sync/playback/:type?start_at=&end_at=",opts:{auth:"optional",parameters:{path:{type:!1},query:{start_at:!1,end_at:!1}}}}),remove:new a({method:s.DELETE,url:"/sync/playback/:id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}})},collection:{get:new a({method:s.GET,url:"/sync/collection/:type",opts:{auth:!0,extended:[o.Full,o.Metadata],parameters:{path:{type:!0},query:{extended:!1}}}}),add:new a({opts:{auth:!0,cache:!1},method:s.POST,url:"/sync/collection",body:{movies:!1,shows:!1,seasons:!1,episodes:!1}}),remove:new a({method:s.POST,url:"/sync/collection/remove",opts:{auth:!0,cache:!1},body:{movies:!1,shows:!1,seasons:!1,episodes:!1}})},watched:new a({method:s.GET,url:"/sync/watched/:type",opts:{auth:!0,extended:[o.Full,o.NoSeasons],parameters:{path:{type:!0},query:{extended:!1}}}}),history:{get:new a({method:s.GET,url:"/sync/history/:type/:id?start_at=&end_at=",opts:{auth:!0,pagination:!0,extended:[o.Full],parameters:{path:{type:!1,id:!1},query:{start_at:!1,end_at:!1,extended:!1}}}}),add:new a({method:s.POST,url:"/sync/history",opts:{auth:!0,cache:!1},body:{movies:!1,shows:!1,seasons:!1,episodes:!1}}),remove:new a({method:s.POST,url:"/sync/history/remove",opts:{auth:!0,cache:!1},body:{movies:!1,shows:!1,seasons:!1,episodes:!1,ids:!1}})},ratings:{get:new a({method:s.GET,url:"/sync/ratings/:type/:rating",opts:{auth:!0,pagination:"optional",extended:[o.Full],parameters:{query:{type:!1,rating:!1,extended:!1}}}}),add:new a({opts:{auth:!0,cache:!1},method:s.POST,url:"/sync/ratings",body:{movies:!1,shows:!1,seasons:!1,episodes:!1}}),remove:new a({method:s.POST,url:"/sync/ratings/remove",opts:{auth:!0,cache:!1},body:{movies:!1,shows:!1,seasons:!1,episodes:!1}})},watchlist:{get:new a({method:s.GET,url:"/sync/watchlist/:type/:sort",opts:{auth:!0,emoji:!0,pagination:"optional",extended:[o.Full],parameters:{path:{type:!1,sort:!1,extended:!1}}}}),update:new a({method:s.PUT,url:"/sync/watchlist",opts:{auth:!0,cache:!1},body:{description:!1,sort_by:!1,sort_how:!1}}),add:new a({method:s.POST,url:"/sync/watchlist",opts:{auth:!0,emoji:!0,cache:!1,vip:"enhanced"},body:{movies:!1,shows:!1,seasons:!1,episodes:!1}}),remove:new a({method:s.POST,url:"/sync/watchlist/remove",opts:{auth:!0,cache:!1},body:{movies:!1,shows:!1,episodes:!1}}),reorder:new a({method:s.POST,url:"/sync/watchlist/reorder",opts:{auth:!0,cache:!1},body:{rank:!0}}),updateItem:new a({method:s.PUT,url:"/sync/watchlist/:list_item_id",opts:{auth:!0,emoji:!0,vip:!0,cache:!1,parameters:{path:{list_item_id:!0}}},body:{notes:!0}})},favorites:{get:new a({method:s.GET,url:"/sync/favorites/:type/:sort",opts:{auth:!0,emoji:!0,pagination:"optional",extended:[o.Full],parameters:{path:{type:!1,sort:!1},query:{extended:!1}}}}),update:new a({method:s.PUT,url:"/sync/favorites",opts:{auth:!0,cache:!1},body:{description:!1,sort_by:!1,sort_how:!1}}),add:new a({method:s.POST,url:"/sync/favorites",opts:{auth:!0,cache:!1},body:{movies:!1,shows:!1}}),remove:new a({method:s.POST,url:"/sync/favorites/remove",opts:{auth:!0,cache:!1},body:{movies:!1,shows:!1}}),reorder:new a({opts:{auth:!0,cache:!1},method:s.POST,url:"/sync/favorites/reorder",body:{rank:!0}}),updateItem:new a({method:s.PUT,url:"/sync/favorites/:list_item_id",opts:{auth:!0,emoji:!0,cache:!1,parameters:{path:{list_item_id:!0}}},body:{notes:!0}})}},gt={settings:new a({method:s.GET,url:"/users/settings",opts:{auth:!0,parameters:{query:{extended:!1}}}}),requests:{following:new a({method:s.GET,url:"/users/requests/following",opts:{auth:!0,extended:[o.Full],parameters:{query:{extended:!1}}}}),follower:new a({method:s.GET,url:"/users/requests",opts:{auth:!0,extended:[o.Full],parameters:{query:{extended:!1}}}}),approve:new a({method:s.POST,url:"/users/requests/:id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}}),deny:new a({method:s.DELETE,url:"/users/requests/:id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}}),savedFilters:new a({method:s.GET,url:"/users/saved_filters/:section",opts:{vip:!0,auth:!0,pagination:!0,parameters:{path:{section:!1}}}}),hidden:{get:new a({method:s.GET,url:"/users/hidden/:section?type=",opts:{auth:!0,pagination:!0,extended:[o.Full],parameters:{path:{section:!0},query:{type:!1,extended:!1}}}}),add:new a({method:s.POST,url:"/users/hidden/:section",opts:{auth:!0,cache:!1,parameters:{path:{section:!0}}},body:{movies:!1,shows:!1,seasons:!1,users:!1}}),remove:new a({method:s.POST,url:"/users/hidden/:section/remove",opts:{auth:!0,cache:!1,parameters:{path:{section:!0}}},body:{movies:!1,shows:!1,seasons:!1,users:!1}})},profile:new a({method:s.GET,url:"/users/:id",opts:{auth:"optional",extended:[o.Full,o.Vip],parameters:{path:{id:!0},query:{extended:!1}}}}),likes:new a({method:s.GET,url:"/users/:id/likes/:type",opts:{auth:"optional",extended:[o.Comments],pagination:!0,parameters:{path:{id:!0,type:!1},query:{extended:!1}}}}),collection:new a({method:s.GET,url:"/users/:id/collection/:type",opts:{auth:"optional",extended:[o.Full,o.Metadata],parameters:{path:{id:!0,type:!0},query:{extended:!1}}}}),comments:new a({method:s.GET,url:"/users/:id/comments/:comment_type/:type?include_replies=false",opts:{auth:"optional",pagination:!0,extended:[o.Full],parameters:{path:{id:!0,comment_type:!1,type:!1},query:{include_replies:!1,extended:!1}}}})},notes:new a({method:s.GET,url:"/users/:id/notes/:type",opts:{vip:!0,auth:"optional",pagination:!0,extended:[o.Full],parameters:{path:{id:!0,type:!0},query:{extended:!1}}}}),lists:{get:new a({method:s.GET,url:"/users/:id/lists",opts:{auth:"optional",emoji:!0,parameters:{path:{id:!0}}}}),create:new a({method:s.POST,url:"/users/:id/lists",opts:{auth:!0,cache:!1,vip:"enhanced",parameters:{path:{id:!0}}},body:{name:!0,description:!1,privacy:!1,display_numbers:!1,allow_comments:!1}}),reorder:new a({method:s.POST,url:"/users/:id/lists/reorder",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}},body:{rank:!0}}),collaborations:new a({method:s.GET,url:"/users/:id/lists/collaborations",opts:{auth:"optional",parameters:{path:{id:!0}}}})},list:{get:new a({method:s.GET,url:"/users/:id/lists/:list_id",opts:{auth:"optional",emoji:!0,parameters:{path:{id:!0,list_id:!0}}}}),update:new a({method:s.PUT,url:"/users/:id/lists/:list_id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0,list_id:!0}}},body:{name:!1,description:!1,privacy:!1,display_numbers:!1,allow_comments:!1}}),delete:new a({method:s.DELETE,url:"/users/:id/lists/:list_id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0,list_id:!0}}}}),likes:new a({method:s.GET,url:"/users/:id/lists/:list_id/likes",opts:{auth:"optional",pagination:!0,parameters:{path:{id:!0,list_id:!0}}}}),like:{add:new a({method:s.POST,url:"/users/:id/lists/:list_id/like",opts:{auth:!0,cache:!1,parameters:{path:{id:!0,list_id:!0}}}}),remove:new a({method:s.DELETE,url:"/users/:id/lists/:list_id/like",opts:{auth:!0,cache:!1,parameters:{path:{id:!0,list_id:!0}}}})},items:{get:new a({method:s.GET,url:"/users/:id/lists/:list_id/items?type=",opts:{emoji:!0,auth:"optional",pagination:"optional",extended:[o.Full],parameters:{path:{id:!0,list_id:!0},query:{type:!1,extended:!1}}},transform:t=>Array.isArray(t.type)?{...t,type:t.type.join(",")}:t}),add:new a({method:s.POST,url:"/users/:id/lists/:list_id/items",opts:{auth:!0,cache:!1,vip:"enhanced",emoji:!0,parameters:{path:{id:!0,list_id:!0}}},body:{movies:!1,shows:!1,seasons:!1,episodes:!1,people:!1}}),remove:new a({method:s.POST,url:"/users/:id/lists/:list_id/items/remove",opts:{auth:!0,cache:!1,parameters:{path:{id:!0,list_id:!0}}},body:{movies:!1,shows:!1,seasons:!1,episodes:!1,people:!1}}),reorder:new a({method:s.POST,url:"/users/:id/lists/:list_id/items/reorder",opts:{auth:!0,cache:!1,parameters:{path:{id:!0,list_id:!0}}},body:{rank:!0}}),update:new a({method:s.PUT,url:"users/:id/lists/:list_id/items/:list_item_id",opts:{auth:!0,vip:!0,emoji:!0,cache:!1,parameters:{path:{id:!0,list_id:!0,list_item_id:!0}}},body:{notes:!0}})},comments:new a({method:s.GET,url:"/users/:id/lists/:list_id/comments/:sort",opts:{pagination:!0,emoji:!0,auth:"optional",parameters:{path:{id:!0,list_id:!0,sort:!1}}}})},follow:{add:new a({method:s.POST,url:"/users/:id/follow",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}}),remove:new a({method:s.DELETE,url:"/users/:id/follow",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}})},followers:new a({method:s.GET,url:"/users/:id/followers",opts:{auth:"optional",extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),following:new a({method:s.GET,url:"/users/:id/following",opts:{auth:"optional",extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),friends:new a({method:s.GET,url:"/users/:id/friends",opts:{auth:"optional",extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),history:new a({method:s.GET,url:"/users/:id/history/:type/:item_id?start_at=&end_at=",opts:{auth:"optional",pagination:!0,extended:[o.Full],parameters:{path:{id:!0,type:!1,item_id:!1},query:{start_at:!1,end_at:!1,extended:!1}}}}),ratings:new a({method:s.GET,url:"/users/:id/ratings/:type/:rating",opts:{auth:"optional",pagination:"optional",extended:[o.Full],parameters:{path:{id:!0,type:!1,rating:!1},query:{extended:!1}}}}),watchlist:{get:new a({method:s.GET,url:"/users/:id/watchlist/:type/:sort",opts:{auth:"optional",pagination:"optional",extended:[o.Full],parameters:{path:{id:!0,type:!1,sort:!1},query:{extended:!1}}}}),comments:new a({method:s.GET,url:"/users/:id/watchlist/comments/:sort",opts:{auth:"optional",pagination:!0,emoji:!0,parameters:{path:{id:!0,sort:!1}}}})},favorites:new a({method:s.GET,url:"/users/:id/recommendations/:type/:sort",opts:{auth:!0,pagination:"optional",extended:[o.Full],parameters:{path:{id:!0,type:!1,sort:!1},query:{extended:!1}}}}),watching:new a({method:s.GET,url:"/users/:id/watching",opts:{auth:"optional",extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),watched:new a({method:s.GET,url:"/users/:id/watched/:type",opts:{auth:"optional",extended:[o.Full,o.NoSeasons],parameters:{path:{id:!0,type:!1},query:{extended:!1}}}}),stats:new a({method:s.GET,url:"/users/:id/stats",opts:{auth:"optional",parameters:{path:{id:!0}}}})},N={date:{dropMinutes:t=>t.replace(/:\d{2}:\d{2}/,":00:00")},array:{toString:(t,e=",")=>t&&Array.isArray(t)?t.join(e):t},search:{escape:t=>t.replace(/[+&|!{}[\]()^"~*?:/\\-]/g,"\\$&")}},wt={date:(t,e=Ye)=>{if(!e.test(t))throw new ce(`Invalide 'start_date' format, found '${t}', expected '${e}'`);return!0}},ve=(t,e)=>r=>{const i=r[t];return i===void 0?!0:typeof i=="string"?wt.date(i,e):!0},Te=(t,e)=>r=>{let i=r[t];return i===void 0?r:(typeof i!="string"&&(i=i instanceof Date?i.toISOString():new Date(i).toISOString()),i.includes("T")&&(i=i.split("T").at(0)),{...r,[t]:N.date.dropMinutes(i)})},U=ve("start_date"),$=Te("start_date"),q={pagination:!0,extended:[o.Full],filters:dt,parameters:{query:{extended:!1}}},yt={trending:new a({method:s.GET,url:"/movies/trending",opts:{...q}}),popular:new a({method:s.GET,url:"/movies/popular",opts:{...q}}),favorited:new a({method:s.GET,url:"/movies/favorited/:period",opts:{...q,parameters:{path:{period:!1}}}}),played:new a({method:s.GET,url:"/movies/played/:period",opts:{...q,parameters:{path:{period:!1}}}}),watched:new a({method:s.GET,url:"/movies/watched/:period",opts:{...q,parameters:{path:{period:!1}}}}),collected:new a({method:s.GET,url:"/movies/collected/:period",opts:{...q,parameters:{path:{period:!1}}}}),anticipated:new a({method:s.GET,url:"/movies/anticipated",opts:{...q}}),boxOffice:new a({method:s.GET,url:"/movies/boxoffice",opts:{extended:[o.Full],parameters:{query:{extended:!1}}}}),updates:new a({method:s.GET,url:"/movies/updates/:start_date",transform:$,validate:U,opts:{pagination:!0,extended:[o.Full],parameters:{path:{start_date:!1},query:{extended:!1}}}}),updatedIds:new a({method:s.GET,url:"/movies/updates/id/:start_date",transform:$,validate:U,opts:{pagination:!0,parameters:{path:{start_date:!1}}}}),summary:new a({method:s.GET,url:"/movies/:id",opts:{extended:[o.Full,o.Images],parameters:{path:{id:!0},query:{extended:!1}}}}),aliases:new a({method:s.GET,url:"/movies/:id/aliases",opts:{parameters:{path:{id:!0}}}}),releases:new a({method:s.GET,url:"/movies/:id/releases/:country",opts:{parameters:{path:{id:!0,country:!1}}}}),translations:new a({method:s.GET,url:"/movies/:id/translations/:language",opts:{parameters:{path:{id:!0,language:!1}}}}),comments:new a({method:s.GET,url:"/movies/:id/comments/:sort",opts:{pagination:!0,emoji:!0,auth:"optional",parameters:{path:{id:!0,sort:!1}}}}),lists:new a({method:s.GET,url:"/movies/:id/lists/:type/:sort",opts:{pagination:!0,emoji:!0,parameters:{path:{id:!0,type:!1,sort:!1}}}}),people:new a({method:s.GET,url:"/movies/:id/people",opts:{extended:[o.Full],parameters:{query:{extended:!1}}}}),ratings:new a({method:s.GET,url:"/movies/:id/ratings",opts:{extended:[o.All],parameters:{path:{id:!0}}}}),related:new a({method:s.GET,url:"/movies/:id/related",opts:{extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),stats:new a({method:s.GET,url:"/movies/:id/stats",opts:{parameters:{path:{id:!0}}}}),studios:new a({method:s.GET,url:"/movies/:id/studios",opts:{parameters:{path:{id:!0}}}}),watching:new a({method:s.GET,url:"/movies/:id/watching",opts:{extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}})},vt={add:new a({method:s.POST,url:"/notes",opts:{auth:!0,vip:!0,emoji:!0,cache:!1},body:{note:!0,spoiler:!1,privacy:!1,movie:!1,show:!1,season:!1,episode:!1,person:!1,history:!1,collection:!1,rating:!1}}),get:new a({method:s.GET,url:"/notes/:id",opts:{auth:!0,vip:!0,emoji:!0,parameters:{path:{id:!0}}}}),update:new a({method:s.PUT,url:"/notes/:id",opts:{auth:!0,vip:!0,emoji:!0,cache:!1,parameters:{path:{id:!0}}}}),delete:new a({method:s.DELETE,url:"/notes/:id",opts:{auth:!0,vip:!0,cache:!1,parameters:{path:{id:!0}}}}),items:new a({method:s.GET,url:"/notes/:id/item",opts:{vip:!0,extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}})},Tt={updates:new a({method:s.GET,url:"/people/updates/:start_date",transform:$,validate:U,opts:{pagination:!0,extended:[o.Full],parameters:{path:{start_date:!1},query:{extended:!1}}}}),updatedIds:new a({method:s.GET,url:"/people/updates/id/:start_date",transform:$,validate:U,opts:{pagination:!0,parameters:{path:{start_date:!1}}}}),summary:new a({method:s.GET,url:"/people/:id",opts:{extended:[o.Full,o.Images],parameters:{path:{id:!0},query:{extended:!1}}}}),movies:new a({method:s.GET,url:"/people/:id/movies",opts:{extended:[o.Full,o.Images],parameters:{path:{id:!0},query:{extended:!1}}}}),shows:new a({method:s.GET,url:"/people/:id/shows",opts:{extended:[o.Full,o.Images],parameters:{path:{id:!0},query:{extended:!1}}}}),lists:new a({method:s.GET,url:"/people/:id/lists/:type/:sort",opts:{pagination:!0,emoji:!0,parameters:{path:{id:!0,type:!1,sort:!1}}}})},Et={movies:{get:new a({method:s.GET,url:"/recommendations/movies/?ignore_collected=false&ignore_watchlisted=false",opts:{auth:!0,extended:[o.Full],parameters:{query:{ignore_collected:!1,ignore_watchlisted:!1,extended:!1}}}}),hide:new a({method:s.DELETE,url:"/recommendations/movies/:id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}})},shows:{get:new a({method:s.GET,url:"/recommendations/shows/?ignore_collected=false&ignore_watchlisted=false",opts:{auth:!0,extended:[o.Full],parameters:{query:{ignore_collected:!1,ignore_watchlisted:!1,extended:!1}}}}),hide:new a({method:s.DELETE,url:"/recommendations/shows/:id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}})}},_t={start:new a({method:s.POST,url:"/scrobble/start",opts:{auth:!0,cache:!1},body:{progress:!0,movie:!1,episode:!1,show:!1}}),pause:new a({method:s.POST,url:"/scrobble/pause",opts:{auth:!0,cache:!1},body:{progress:!0,movie:!1,episode:!1,show:!1}}),stop:new a({method:s.POST,url:"/scrobble/stop",opts:{auth:!0,cache:!1},body:{progress:!0,movie:!1,episode:!1,show:!1}})},bt={text:new a({method:s.GET,url:"/search/:type?query=&fields=",transform(t){const e={...t};return t.type&&(e.type=N.array.toString(t.type)),t.fields&&(e.fields=N.array.toString(t.fields)),t.escape&&t.query&&(e.query=N.search.escape(t.query)),e},opts:{pagination:!0,extended:[o.Full],filters:I,parameters:{path:{type:!1},query:{query:!0,fields:!1}}}}),id:new a({method:s.GET,url:"/search/:id_type/:id?type=",transform(t){const e={...t};return t.type&&(e.type=N.array.toString(t.type)),e},opts:{pagination:!0,extended:[o.Full],parameters:{path:{id_type:!0,id:!0},query:{type:!1}}}})},xt={summary:new a({method:s.GET,url:"/shows/:id/seasons",opts:{extended:[o.Full,o.Episodes,o.Images],parameters:{path:{id:!0},query:{extended:!1}}}}),season:new a({method:s.GET,url:"/shows/:id/seasons/:season?translations=",opts:{extended:[o.Full,o.Images],parameters:{path:{id:!0,season:!0},query:{translations:!1,extended:!1}}}}),translations:new a({method:s.GET,url:"/shows/:id/seasons/:season/translations/:language",opts:{parameters:{path:{id:!0,season:!0,language:!1}}}}),comments:new a({method:s.GET,url:"/shows/:id/seasons/:season/comments/:sort",opts:{pagination:!0,emoji:!0,auth:"optional",parameters:{path:{id:!0,season:!0,sort:!1}}}}),lists:new a({method:s.GET,url:"/shows/:id/seasons/:season/lists/:type/:sort",opts:{pagination:!0,emoji:!0,parameters:{path:{id:!0,season:!0,type:!1,sort:!1}}}}),people:new a({method:s.GET,url:"/shows/:id/seasons/:season/people",opts:{extended:[o.GuestStars],parameters:{path:{id:!0,season:!0}}}}),ratings:new a({method:s.GET,url:"/shows/:id/seasons/:season/ratings",opts:{extended:[o.All],parameters:{path:{id:!0,season:!0}}}}),stats:new a({method:s.GET,url:"/shows/:id/seasons/:season/stats",opts:{parameters:{path:{id:!0,season:!0}}}}),watching:new a({method:s.GET,url:"/shows/:id/seasons/:season/watching",opts:{extended:[o.Full],parameters:{path:{id:!0,season:!0},query:{extended:!1}}}})},D={pagination:!0,extended:[o.Full],filters:ge,parameters:{query:{extended:!1}}},kt={trending:new a({method:s.GET,url:"/shows/trending",opts:{...D}}),popular:new a({method:s.GET,url:"/shows/popular",opts:{...D}}),favorited:new a({method:s.GET,url:"/shows/favorited/:period",opts:{...D,parameters:{path:{period:!1}}}}),played:new a({method:s.GET,url:"/shows/played/:period",opts:{...D,parameters:{path:{period:!1}}}}),watched:new a({method:s.GET,url:"/shows/watched/:period",opts:{...D,parameters:{path:{period:!1}}}}),collected:new a({method:s.GET,url:"/shows/collected",opts:{...D,parameters:{path:{period:!1}}}}),anticipated:new a({method:s.GET,url:"/shows/anticipated",opts:{...D}}),updates:new a({method:s.GET,url:"/shows/updates/:start_date",transform:$,validate:U,opts:{pagination:!0,extended:[o.Full],parameters:{path:{start_date:!1},query:{extended:!1}}}}),updatedIds:new a({method:s.GET,url:"/shows/updates/id/:start_date",transform:$,validate:U,opts:{pagination:!0,parameters:{path:{start_date:!1}}}}),summary:new a({method:s.GET,url:"/shows/:id",opts:{extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),aliases:new a({method:s.GET,url:"/shows/:id/aliases",opts:{parameters:{path:{id:!0}}}}),certifications:new a({method:s.GET,url:"/shows/:id/certifications",opts:{parameters:{path:{id:!0}}}}),translations:new a({method:s.GET,url:"/shows/:id/translations/:language",opts:{parameters:{path:{id:!0,language:!1}}}}),comments:new a({method:s.GET,url:"/shows/:id/comments/:sort",opts:{pagination:!0,emoji:!0,auth:"optional",parameters:{path:{id:!0,sort:!1}}}}),lists:new a({method:s.GET,url:"/shows/:id/lists/:type/:sort",opts:{pagination:!0,emoji:!0,parameters:{path:{id:!0,type:!1,sort:!1}}}}),progress:{collection:new a({method:s.GET,url:"/shows/:id/progress/collection?hidden=false&specials=false&count_specials=true",opts:{auth:!0,parameters:{path:{id:!0},query:{hidden:!1,specials:!1,count_specials:!1}}}}),watched:new a({method:s.GET,url:"/shows/:id/progress/watched?hidden=&specials=&count_specials=&last_activity=",opts:{auth:!0,parameters:{path:{id:!0},query:{hidden:!1,specials:!1,count_specials:!1}}}}),reset:new a({method:s.POST,url:"/shows/:id/progress/watched/reset",opts:{auth:!0,vip:!0,cache:!1,parameters:{path:{id:!0}}}}),undoReset:new a({method:s.DELETE,url:"/shows/:id/progress/watched/reset",opts:{auth:!0,vip:!0,cache:!1,parameters:{path:{id:!0}}}})},people:new a({method:s.GET,url:"/shows/:id/people",opts:{extended:[o.Full,o.GuestStars],parameters:{path:{id:!0},query:{extended:!1}}}}),ratings:new a({method:s.GET,url:"/shows/:id/ratings",opts:{extended:[o.All],parameters:{path:{id:!0}}}}),related:new a({method:s.GET,url:"/shows/:id/related",opts:{pagination:!0,extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),stats:new a({method:s.GET,url:"/shows/:id/stats",opts:{parameters:{path:{id:!0}}}}),studios:new a({method:s.GET,url:"/shows/:id/studios",opts:{parameters:{path:{id:!0}}}}),watching:new a({method:s.GET,url:"/shows/:id/watching",opts:{extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),nextEpisode:new a({method:s.GET,url:"/shows/:id/next_episode",opts:{extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),lastEpisode:new a({method:s.GET,url:"/shows/:id/last_episode",opts:{extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}})},k={extended:[o.Full],filters:I,parameters:{path:{start_date:!1,days:!1},query:{extended:!1}}},F=ve("start_date",Qe),G=Te("start_date"),Ft={my:{shows:{get:new a({method:s.GET,url:"/calendars/my/shows/:start_date/:days",opts:{auth:!0,...k},validate:F,transform:G}),new:new a({method:s.GET,url:"/calendars/my/shows/new/:start_date/:days",opts:{auth:!0,...k},validate:F,transform:G}),premieres:new a({method:s.GET,url:"/calendars/my/shows/premieres/:start_date/:days",opts:{auth:!0,...k},validate:F,transform:G}),finales:new a({method:s.GET,url:"/calendars/my/shows/finales/:start_date/:days",opts:{auth:!0,...k},validate:F,transform:G})},movies:new a({method:s.GET,url:"/calendars/my/movies/:start_date/:days",opts:{auth:!0,...k},validate:F,transform:G}),dvd:new a({method:s.GET,url:"/calendars/my/dvd/:start_date/:days",opts:{auth:!0,...k},validate:F,transform:G})},all:{shows:{get:new a({method:s.GET,url:"/calendars/all/shows/:start_date/:days",opts:k,validate:F,transform:G}),new:new a({method:s.GET,url:"/calendars/all/shows/new/:start_date/:days",opts:k,validate:F,transform:G}),premieres:new a({method:s.GET,url:"/calendars/all/shows/premieres/:start_date/:days",opts:k,validate:F,transform:G}),finales:new a({method:s.GET,url:"/calendars/all/finales/:start_date/:days",opts:k,validate:F,transform:G}),movies:new a({method:s.GET,url:"/calendars/all/movies/:start_date/:days",opts:k,validate:F,transform:G})},dvd:new a({method:s.GET,url:"/calendars/all/dvd/:start_date/:days",opts:k,validate:F,transform:G})}},Gt={add:new a({method:s.POST,url:"/checkin",opts:{auth:!0,cache:!1},body:{sharing:!1,message:!1,movie:!1,episode:!1,show:!1}}),delete:new a({method:s.DELETE,url:"/checkin",opts:{auth:!0,cache:!1}})},Pt={comment:{add:new a({method:s.POST,url:"/comments",opts:{auth:!0,emoji:!0,cache:!1},body:{comment:!0,spoiler:!1,sharing:!1,movie:!1,show:!1,season:!1,episode:!1,list:!1}}),get:new a({method:s.GET,url:"/comments/:id",opts:{emoji:!0,parameters:{path:{id:!0}}}}),update:new a({method:s.PUT,url:"/comments/:id",opts:{auth:!0,emoji:!0,cache:!1,parameters:{path:{id:!0}}},body:{comment:!0,spoiler:!1}}),remove:new a({method:s.DELETE,url:"/comments/:id",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}}),replies:{get:new a({method:s.GET,url:"/comments/:id/replies",opts:{emoji:!0,pagination:!0,parameters:{path:{id:!0}}}}),add:new a({method:s.POST,url:"/comments/:id/replies",opts:{auth:!0,emoji:!0,cache:!1,parameters:{path:{id:!0},query:{comment:!0,spoiler:!1}}},body:{comment:!0,spoiler:!1}})},item:new a({method:s.GET,url:"/comments/:id/item",opts:{extended:[o.Full],parameters:{path:{id:!0},query:{extended:!1}}}}),likes:new a({method:s.GET,url:"/comments/:id/likes",opts:{pagination:!0,parameters:{path:{id:!0}}}}),like:{add:new a({method:s.POST,url:"/comments/:id/like",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}}),remove:new a({method:s.DELETE,url:"/comments/:id/like",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}})},trending:new a({method:s.GET,url:"/comments/trending/:comment_type/:type?include_replies=false",opts:{emoji:!0,pagination:!0,extended:[o.Full],parameters:{path:{comment_type:!1,type:!1},query:{include_replies:!1,extended:!1}}}}),recent:new a({method:s.GET,url:"/comments/recent/:comment_type/:type?include_replies=false",opts:{emoji:!0,pagination:!0,extended:[o.Full],parameters:{path:{comment_type:!1,type:!1},query:{include_replies:!1,extended:!1}}}}),updates:new a({method:s.GET,url:"/comments/updates/:comment_type/:type?include_replies=false",opts:{emoji:!0,pagination:!0,extended:[o.Full],parameters:{path:{comment_type:!1,type:!1},query:{include_replies:!1,extended:!1}}}})}},St={summary:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode",opts:{extended:[o.Full,o.Images],parameters:{path:{id:!0,season:!0,episode:!0},query:{extended:!1}}}}),translations:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode/translations/:language",opts:{parameters:{path:{id:!0,season:!0,episode:!0,language:!1}}}}),comments:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode/comments/:sort",opts:{pagination:!0,emoji:!0,auth:"optional",parameters:{path:{id:!0,season:!0,episode:!0,sort:!1}}}}),lists:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode/lists/:type/:sort",opts:{pagination:!0,emoji:!0,parameters:{path:{id:!0,season:!0,episode:!0,type:!1,sort:!1}}}}),people:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode/people",opts:{extended:[o.GuestStars],parameters:{path:{id:!0,season:!0,episode:!0},query:{extended:!1}}}}),ratings:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode/ratings",opts:{extended:[o.All],parameters:{path:{id:!0,season:!0,episode:!0}}}}),stats:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode/stats",opts:{parameters:{path:{id:!0,season:!0,episode:!0}}}}),watching:new a({method:s.GET,url:"/shows/:id/seasons/:season/episodes/:episode/watching",opts:{extended:[o.Full],parameters:{path:{id:!0,season:!0,episode:!0},query:{extended:!1}}}})},At={trending:new a({method:s.GET,url:"/lists/trending",opts:{pagination:!0,emoji:!0}}),popular:new a({method:s.GET,url:"/lists/popular",opts:{pagination:!0,emoji:!0}}),list:new a({method:s.GET,url:"/lists/:id",opts:{emoji:!0,parameters:{path:{id:!0}}}}),likes:new a({method:s.GET,url:"/lists/:id/likes",opts:{pagination:!0,parameters:{path:{id:!0}}}}),like:{add:new a({method:s.GET,url:"/lists/:id/like",opts:{auth:!0,parameters:{path:{id:!0}}}}),remove:new a({method:s.DELETE,url:"/lists/:id/like",opts:{auth:!0,cache:!1,parameters:{path:{id:!0}}}})},items:new a({method:s.GET,url:"/lists/:id/items/:type",opts:{pagination:"optional",extended:[o.Full],parameters:{path:{id:!0,type:!1},query:{extended:!1}}},transform:t=>Array.isArray(t.type)?{...t,type:t.type.join(",")}:t}),comments:new a({method:s.GET,url:"/lists/:id/comments/:sort",opts:{pagination:!0,emoji:!0,auth:"optional",parameters:{path:{id:!0,sort:!1}}}})},Dt={authentication:pe,calendars:Ft,checkin:Gt,certifications:new a({method:s.GET,url:"/certifications/:type",opts:{parameters:{path:{type:!0}}}}),comments:Pt,countries:new a({method:s.GET,url:"/countries/:type",opts:{parameters:{path:{type:!0}}}}),genres:new a({method:s.GET,url:"/genres/:type",opts:{parameters:{path:{type:!0}}}}),languages:new a({method:s.GET,url:"/languages/:type",opts:{parameters:{path:{type:!0}}}}),lists:At,movies:yt,networks:new a({method:s.GET,url:"/networks",opts:{pagination:"optional"}}),notes:vt,people:Tt,recommendations:Et,scrobble:_t,search:bt,shows:kt,seasons:xt,episodes:St,sync:ft,users:gt},Rt={Endpoint:{Production:"https://api.trakt.tv"}};export{Rt as C,qt as T,Dt as t};
