var Ge=Object.defineProperty;var Ye=(n,o,i)=>o in n?Ge(n,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[o]=i;var K=(n,o,i)=>Ye(n,typeof o!="symbol"?o+"":o,i);import{j as e,r as I}from"./react-y421CpiH.js";import{c as qe}from"./react-dom-BlTi8VmG.js";import{u as Je,A as Z,G as C,T as y,a as Xe,S as Ze,N as ke,r as Ie,D as _e,B as L,P as F,F as V,L as H,b as l,c as E,C as D,d as Ae,e as Qe,f as U,g as ne,h as we,i as z,j as P,R as ae,k as J,l as $e,m as ue,n as Ke,o as et,p as Te,q as pe,s as tt,t as st,v as ee,w as ot,x as xe,y as rt,z as ie,M as it,E as nt,H as at}from"./@mantine-BvmJJjMl.js";import{C as lt,T as De,t as ze}from"./@dvcol-BUmHU4Tx.js";import{a as $,u as k}from"./jotai-BeAvdwE9.js";import{u as Ne,L as te,a as ct,B as dt,R as Ee,b as O,N as me}from"./react-router-Dl2tNxSQ.js";import{I as ht,a as gt,b as ut,c as pt,d as xt,e as ye,f as mt,g as jt,h as le,i as wt,j as W,k as B,l as se,m as yt,n as ft,o as vt,p as ge,q as bt,r as St,s as Le}from"./@tabler-BkZ_KyXu.js";import"./cookie-BX9QSSmL.js";import"./scheduler-SPyfQU6S.js";import"./clsx-B-dksMZM.js";import"./react-remove-scroll-Dr9wXWx0.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-afg9dGuF.js";import"./react-style-singleton-CyNMHa0l.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-CE9TMX03.js";import"./use-callback-ref-aUdyBp6w.js";import"./react-number-format-_XYWQ0vM.js";import"./@floating-ui-CRVfjoPE.js";import"./react-transition-group-3Ugc7Bz-.js";import"./@babel-CRMhvSYP.js";import"./dayjs--Ub8zkb-.js";import"./uuid-C_lTrkZC.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(t){if(t.ep)return;t.ep=!0;const r=i(t);fetch(t.href,r)}})();function Ct(n){return"movie"in n}function kt(n){return"show"in n&&"seasons"in n}const It="",At="",$t=window.location.origin,q=class q{constructor(){K(this,"client");K(this,"settings");K(this,"credentials");this.credentials={clientId:It,clientSecret:At,redirectUri:$t};const o=this.getCredentials();o&&(this.credentials=o),this.settings={client_id:this.credentials.clientId,client_secret:this.credentials.clientSecret,redirect_uri:this.credentials.redirectUri,endpoint:lt.Endpoint.Production,useragent:"Traktarr"};const i=this.getStoredAuth();this.client=new De(this.settings,i,ze)}static getInstance(){return q.instance||(q.instance=new q),q.instance}getClient(){return this.client}isAuthenticated(){const o=this.client.auth;return!!(o.access_token&&o.expires&&o.expires>Date.now())}getStoredAuth(){try{const o=localStorage.getItem("trakt_auth");return o?JSON.parse(o):{}}catch(o){return console.error("Failed to parse stored authentication:",o),{}}}storeAuth(o){localStorage.setItem("trakt_auth",JSON.stringify(o))}clearAuth(){localStorage.removeItem("trakt_auth"),this.client.importAuthentication({})}getCredentials(){try{const o=localStorage.getItem("trakt_credentials");return o?JSON.parse(o):null}catch(o){return console.error("Failed to parse stored credentials:",o),null}}hasValidCredentials(){const o=this.getCredentials();return!!(o&&o.clientId&&o.clientSecret&&o.redirectUri)}saveCredentials(o){localStorage.setItem("trakt_credentials",JSON.stringify(o)),this.credentials=o,this.settings={...this.settings,client_id:o.clientId,client_secret:o.clientSecret,redirect_uri:o.redirectUri};const i=this.getStoredAuth();this.client=new De(this.settings,i,ze)}getAuthorizationUrl(){const o=Math.random().toString(36).substring(2,15);return this.client.redirectToAuthenticationUrl({state:o})}async handleAuthCallback(o){try{await this.client.exchangeCodeForToken(o),this.storeAuth(this.client.auth)}catch(i){throw console.error("Failed to exchange code for token:",i),i}}async startDeviceAuth(){try{const o=await this.client.getDeviceCode();return{userCode:o.user_code,verificationUrl:o.verification_url}}catch(o){throw console.error("Failed to start device authentication:",o),o}}async pollDeviceAuth(){try{await this.client.pollWithDeviceCode(),this.storeAuth(this.client.auth)}catch(o){throw console.error("Device authentication polling failed:",o),o}}async logout(){try{this.isAuthenticated()&&await this.client.revokeAuthentication(),this.clearAuth()}catch(o){console.error("Failed to logout:",o),this.clearAuth()}}async getAllHistory(o={}){const i=[];let s=1;const t=o.limit||1e3;let r=1;do{const{data:a,headers:h}=await this.getHistoryWithHeaders({...o,page:s,limit:t});i.push(...a),r=h["x-pagination-page-count"]?parseInt(h["x-pagination-page-count"],10):s,s+=1}while(s<=r);return i}async getHistory(o={}){const i={};return o.type&&(i.type=o.type),i.pagination={page:o.page||1,limit:o.limit||100},o.startDate?i.start_at=o.startDate.toISOString():o.start_at&&(i.start_at=o.start_at),o.endDate?i.end_at=o.endDate.toISOString():o.end_at&&(i.end_at=o.end_at),(await this.client.sync.history.get(i)).json()}async getHistoryWithHeaders(o={}){const i={};o.type&&(i.type=o.type),i.pagination={page:Number(o.page||1),limit:Number(o.limit||100)},o.startDate?i.start_at=o.startDate.toISOString():o.start_at&&(i.start_at=o.start_at),o.endDate?i.end_at=o.endDate.toISOString():o.end_at&&(i.end_at=o.end_at),console.log("Fetching history with params:",JSON.stringify(i));try{const s=await this.client.sync.history.get(i);console.log("Response headers:",Array.from(s.headers.entries())),console.log("Pagination page:",s.headers.get("X-Pagination-Page")),console.log("Pagination limit:",s.headers.get("X-Pagination-Limit")),console.log("Pagination page count:",s.headers.get("X-Pagination-Page-Count")),console.log("Pagination item count:",s.headers.get("X-Pagination-Item-Count"));const t={},r=s.headers.get("X-Pagination-Page"),a=s.headers.get("X-Pagination-Page-Count"),h=s.headers.get("X-Pagination-Limit"),m=s.headers.get("X-Pagination-Item-Count");return r&&(t["x-pagination-page"]=r),a&&(t["x-pagination-page-count"]=a),h&&(t["x-pagination-limit"]=h),m&&(t["x-pagination-item-count"]=m),{data:await s.json(),headers:t}}catch(s){throw console.error("Error fetching history:",s),s}}async getWatched(o){return(await this.client.sync.watched({type:o})).json()}async getRatings(o={}){const i={};return o.type&&(i.type=o.type),o.rating&&(i.rating=o.rating),(await this.client.sync.ratings.get(i)).json()}async getCollection(o){return(await this.client.sync.collection.get({type:o})).json()}async getStats(){return(await this.client.users.stats({id:"me"})).json()}applyFilters(o,i){let s=[...o];if(i.type&&i.type!=="all"&&(s=s.filter(t=>{let r;"type"in t&&(r=String(t.type));const a=i.type==="movies"?"movie":i.type==="shows"?"show":i.type==="episodes"?"episode":i.type;return r&&r===a?!0:"movie"in t&&t.movie?a==="movie":"show"in t&&!("episode"in t)&&t.show?a==="show":"episode"in t&&t.episode?a==="episode":!1})),typeof i.rating=="number"&&(s=s.filter(t=>("rating"in t&&typeof t.rating=="number"?t.rating:"movie"in t&&t.movie&&typeof t.movie=="object"&&"rating"in t.movie?t.movie.rating:"show"in t&&t.show&&typeof t.show=="object"&&"rating"in t.show?t.show.rating:"episode"in t&&t.episode&&typeof t.episode=="object"&&"rating"in t.episode?t.episode.rating:0)>=(i.rating||0))),typeof i.genre=="string"&&(s=s.filter(t=>("movie"in t&&t.movie&&typeof t.movie=="object"&&"genres"in t.movie&&Array.isArray(t.movie.genres)?t.movie.genres:"show"in t&&t.show&&typeof t.show=="object"&&"genres"in t.show&&Array.isArray(t.show.genres)?t.show.genres:[]).includes(i.genre))),typeof i.year=="number"&&(s=s.filter(t=>("movie"in t&&t.movie&&typeof t.movie=="object"&&"year"in t.movie?t.movie.year:"show"in t&&t.show&&typeof t.show=="object"&&"year"in t.show?t.show.year:0)===i.year)),i.search){const t=i.search.toLowerCase();s=s.filter(r=>("movie"in r&&r.movie&&typeof r.movie=="object"&&"title"in r.movie?r.movie.title:"show"in r&&r.show&&typeof r.show=="object"&&"title"in r.show?r.show.title:"episode"in r&&r.episode&&typeof r.episode=="object"&&"title"in r.episode?r.episode.title:"").toLowerCase().includes(t))}return i.sortBy&&s.sort((t,r)=>{let a="",h="";switch(i.sortBy){case"title":a="movie"in t&&t.movie&&typeof t.movie=="object"&&"title"in t.movie?t.movie.title:"show"in t&&t.show&&typeof t.show=="object"&&"title"in t.show?t.show.title:"episode"in t&&t.episode&&typeof t.episode=="object"&&"title"in t.episode?t.episode.title:"",h="movie"in r&&r.movie&&typeof r.movie=="object"&&"title"in r.movie?r.movie.title:"show"in r&&r.show&&typeof r.show=="object"&&"title"in r.show?r.show.title:"episode"in r&&r.episode&&typeof r.episode=="object"&&"title"in r.episode?r.episode.title:"";break;case"year":a="movie"in t&&t.movie&&typeof t.movie=="object"&&"year"in t.movie?t.movie.year:"show"in t&&t.show&&typeof t.show=="object"&&"year"in t.show?t.show.year:0,h="movie"in r&&r.movie&&typeof r.movie=="object"&&"year"in r.movie?r.movie.year:"show"in r&&r.show&&typeof r.show=="object"&&"year"in r.show?r.show.year:0;break;case"rating":a="rating"in t&&typeof t.rating=="number"?t.rating:"movie"in t&&t.movie&&typeof t.movie=="object"&&"rating"in t.movie?t.movie.rating:"show"in t&&t.show&&typeof t.show=="object"&&"rating"in t.show?t.show.rating:"episode"in t&&t.episode&&typeof t.episode=="object"&&"rating"in t.episode?t.episode.rating:0,h="rating"in r&&typeof r.rating=="number"?r.rating:"movie"in r&&r.movie&&typeof r.movie=="object"&&"rating"in r.movie?r.movie.rating:"show"in r&&r.show&&typeof r.show=="object"&&"rating"in r.show?r.show.rating:"episode"in r&&r.episode&&typeof r.episode=="object"&&"rating"in r.episode?r.episode.rating:0;break;case"watched_at":a="watched_at"in t&&typeof t.watched_at=="string"?t.watched_at:"last_watched_at"in t&&typeof t.last_watched_at=="string"?t.last_watched_at:"",h="watched_at"in r&&typeof r.watched_at=="string"?r.watched_at:"last_watched_at"in r&&typeof r.last_watched_at=="string"?r.last_watched_at:"";break;case"collected_at":a="collected_at"in t&&typeof t.collected_at=="string"?t.collected_at:"",h="collected_at"in r&&typeof r.collected_at=="string"?r.collected_at:"";break;default:a="movie"in t&&t.movie&&typeof t.movie=="object"&&"title"in t.movie?t.movie.title:"show"in t&&t.show&&typeof t.show=="object"&&"title"in t.show?t.show.title:"episode"in t&&t.episode&&typeof t.episode=="object"&&"title"in t.episode?t.episode.title:"",h="movie"in r&&r.movie&&typeof r.movie=="object"&&"title"in r.movie?r.movie.title:"show"in r&&r.show&&typeof r.show=="object"&&"title"in r.show?r.show.title:"episode"in r&&r.episode&&typeof r.episode=="object"&&"title"in r.episode?r.episode.title:""}return typeof a=="string"&&typeof h=="string"?i.sortOrder==="desc"?h.localeCompare(a):a.localeCompare(h):i.sortOrder==="desc"?h-a:a-h}),s}filterByDateRange(o,i,s){return!i&&!s?o:o.filter(t=>{if(!t.watched_at)return!1;const r=new Date(t.watched_at);return!(i&&r<i||s&&r>s)})}async exportData(o,i,s){const t={...o};if(i==="json"){const r=JSON.stringify(t,null,2),a="application/json",h=new Blob([r],{type:a}),m=URL.createObjectURL(h),f=document.createElement("a");f.href=m,s.endsWith(`.${i}`)||(s=`${s}.${i}`),f.download=s,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(m)}else if(i==="csv")try{t.history&&Array.isArray(t.history)&&t.history.length>0&&this.downloadCSV(this.convertHistoryToCSV(t.history),`${s}-history.csv`),t.watchedMovies&&Array.isArray(t.watchedMovies)&&t.watchedMovies.length>0&&this.downloadCSV(this.convertWatchedMoviesToCSV(t.watchedMovies),`${s}-watched-movies.csv`),t.watchedShows&&Array.isArray(t.watchedShows)&&t.watchedShows.length>0&&this.downloadCSV(this.convertWatchedShowsToCSV(t.watchedShows),`${s}-watched-shows.csv`),t.ratings&&Array.isArray(t.ratings)&&t.ratings.length>0&&this.downloadCSV(this.convertRatingsToCSV(t.ratings),`${s}-ratings.csv`),t.collectionMovies&&Array.isArray(t.collectionMovies)&&t.collectionMovies.length>0&&this.downloadCSV(this.convertCollectionToCSV(t.collectionMovies),`${s}-collection-movies.csv`),t.collectionShows&&Array.isArray(t.collectionShows)&&t.collectionShows.length>0&&this.downloadCSV(this.convertCollectionToCSV(t.collectionShows),`${s}-collection-shows.csv`),t.stats&&this.downloadCSV(this.convertStatsToCSV(t.stats),`${s}-stats.csv`)}catch(r){throw console.error("Error creating CSV downloads:",r),new Error("Failed to download CSV files")}else throw new Error(`Unsupported export format: ${i}`)}downloadCSV(o,i){const s=new Blob([o],{type:"text/csv"}),t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}convertHistoryToCSV(o){let i=`ID,Type,Title,Season,Episode Number,Episode Title,Show Title,Year,Watched At,Trakt ID,IMDB ID,TMDB ID,Runtime,Genres
`;return o.forEach(s=>{var a,h,m,f,p,g;const t=s.id||"",r=s.watched_at||"";if(s.type==="movie"&&"movie"in s&&s.movie){const d=s.movie,c=d.title||"Unknown",w=d.year||"",j=((a=d.ids)==null?void 0:a.trakt)||"",S=((h=d.ids)==null?void 0:h.imdb)||"",x=((m=d.ids)==null?void 0:m.tmdb)||"",v=d.runtime||"",u=d.genres?d.genres.join(", "):"";i+=`${t},movie,${this.escapeCSV(c)},,,,${this.escapeCSV("")},${w},${r},${j},${S},${x},${v},${this.escapeCSV(u)}
`}else if(s.type==="episode"&&"episode"in s&&"show"in s&&s.episode&&s.show){const d=s.episode,c=s.show,w=c.title||"Unknown",j=c.year||"",S=d.title||"",x=d.season||"",v=d.number||"",u=((f=d.ids)==null?void 0:f.trakt)||"",b=((p=d.ids)==null?void 0:p.tmdb)||"",_=((g=c.ids)==null?void 0:g.imdb)||"",R=d.runtime||(c==null?void 0:c.runtime)||"",G=c.genres?c.genres.join(", "):"";i+=`${t},episode,${this.escapeCSV(S)},${x},${v},${this.escapeCSV(S)},${this.escapeCSV(w)},${j},${r},${u},${_},${b},${R},${this.escapeCSV(G)}
`}}),i}convertWatchedMoviesToCSV(o){let i=`Movie Title,Year,Plays,Last Watched,Runtime (min),Genres,Trakt ID,IMDB ID,TMDB ID
`;return o.forEach(s=>{var c,w,j;if(!Ct(s))return;const t=s.movie.title||"Unknown",r=s.movie.year||"",a=s.plays||0,h=s.last_watched_at||"",m=s.movie.runtime||"",f=s.movie.genres?s.movie.genres.join(", "):"",p=((c=s.movie.ids)==null?void 0:c.trakt)||"",g=((w=s.movie.ids)==null?void 0:w.imdb)||"",d=((j=s.movie.ids)==null?void 0:j.tmdb)||"";i+=`${this.escapeCSV(t)},${r},${a},${h},${m},${this.escapeCSV(f)},${p},${g},${d}
`}),i}convertWatchedShowsToCSV(o){let i=`Show Title,Show Year,Season,Episode,Episode Title,Plays,Last Watched,Trakt ID,IMDB ID
`;return o.filter(kt).forEach(t=>{var p,g;const r=t,a=r.show.title||"Unknown",h=r.show.year||"",m=((p=r.show.ids)==null?void 0:p.trakt)||"",f=((g=r.show.ids)==null?void 0:g.imdb)||"";r.seasons&&Array.isArray(r.seasons)&&r.seasons.forEach(d=>{const c=d.number||"";d.episodes&&Array.isArray(d.episodes)&&d.episodes.forEach(w=>{const j=w.number||"",S=w.plays||0,x=w.last_watched_at||"";i+=`${this.escapeCSV(a)},${h},${c},${j},,${S},${x},${m},${f}
`})})}),i}convertRatingsToCSV(o){let i=`Type,Title,Rating,Rated At,Year,Season,Episode,Show Title,Trakt ID,IMDB ID
`;return o.forEach(s=>{var w,j,S,x,v,u,b,_;const t=s.type||"",r=s.rating||"",a=s.rated_at||"";let h="",m="",f="",p="",g="",d="",c="";t==="movie"&&"movie"in s&&s.movie?(h=s.movie.title||"Unknown",m=s.movie.year?String(s.movie.year):"",d=(w=s.movie.ids)!=null&&w.trakt?String(s.movie.ids.trakt):"",c=((j=s.movie.ids)==null?void 0:j.imdb)||""):t==="show"&&"show"in s&&s.show?(h=s.show.title||"Unknown",m=s.show.year?String(s.show.year):"",d=(S=s.show.ids)!=null&&S.trakt?String(s.show.ids.trakt):"",c=((x=s.show.ids)==null?void 0:x.imdb)||""):t==="season"&&"season"in s&&"show"in s&&s.season&&s.show?(f=s.season.number?String(s.season.number):"",g=s.show.title||"Unknown",m=s.show.year?String(s.show.year):"",h=`Season ${f}`,d=(v=s.season.ids)!=null&&v.trakt?String(s.season.ids.trakt):"",c=((u=s.show.ids)==null?void 0:u.imdb)||""):t==="episode"&&"episode"in s&&"show"in s&&s.episode&&s.show&&(p=s.episode.number?String(s.episode.number):"",f=s.episode.season?String(s.episode.season):"",h=s.episode.title||"Unknown",g=s.show.title||"Unknown",m=s.show.year?String(s.show.year):"",d=(b=s.episode.ids)!=null&&b.trakt?String(s.episode.ids.trakt):"",c=((_=s.show.ids)==null?void 0:_.imdb)||""),i+=`${t},${this.escapeCSV(h)},${r},${a},${m},${f},${p},${this.escapeCSV(g)},${d},${c}
`}),i}convertCollectionToCSV(o){let i=`Type,Title,Year,Collected At,Trakt ID,IMDB ID,TMDB ID,Runtime,Genres
`;return o.forEach(s=>{var t,r,a,h,m,f;if("movie"in s&&s.movie){const p=s.movie.title||"Unknown",g=s.movie.year||"",d="movie",c=s.collected_at||"",w=((t=s.movie.ids)==null?void 0:t.trakt)||"",j=((r=s.movie.ids)==null?void 0:r.imdb)||"",S=((a=s.movie.ids)==null?void 0:a.tmdb)||"",x=s.movie.runtime||"",v=s.movie.genres?s.movie.genres.join(", "):"";i+=`${d},${this.escapeCSV(p)},${g},${c},${w},${j},${S},${x},${this.escapeCSV(v)}
`}else if("show"in s&&s.show){const p=s.show.title||"Unknown",g=s.show.year||"",d="show",c="",w=((h=s.show.ids)==null?void 0:h.trakt)||"",j=((m=s.show.ids)==null?void 0:m.imdb)||"",S=((f=s.show.ids)==null?void 0:f.tmdb)||"",x=s.show.runtime||"",v=s.show.genres?s.show.genres.join(", "):"";i+=`${d},${this.escapeCSV(p)},${g},${c},${w},${j},${S},${x},${this.escapeCSV(v)}
`}}),i}convertStatsToCSV(o){let i=`Category,Metric,Value
`;return o.movies&&(i+=`Movies,Plays,${o.movies.plays||0}
`,i+=`Movies,Watched,${o.movies.watched||0}
`,i+=`Movies,Minutes,${o.movies.minutes||0}
`,i+=`Movies,Collected,${o.movies.collected||0}
`,i+=`Movies,Ratings,${o.movies.ratings||0}
`,i+=`Movies,Comments,${o.movies.comments||0}
`),o.shows&&(i+=`Shows,Watched,${o.shows.watched||0}
`,i+=`Shows,Collected,${o.shows.collected||0}
`,i+=`Shows,Ratings,${o.shows.ratings||0}
`,i+=`Shows,Comments,${o.shows.comments||0}
`),o.episodes&&(i+=`Episodes,Plays,${o.episodes.plays||0}
`,i+=`Episodes,Watched,${o.episodes.watched||0}
`,i+=`Episodes,Minutes,${o.episodes.minutes||0}
`,i+=`Episodes,Collected,${o.episodes.collected||0}
`,i+=`Episodes,Ratings,${o.episodes.ratings||0}
`,i+=`Episodes,Comments,${o.episodes.comments||0}
`),o.network&&(i+=`Network,Friends,${o.network.friends||0}
`,i+=`Network,Followers,${o.network.followers||0}
`,i+=`Network,Following,${o.network.following||0}
`),o.ratings&&o.ratings.distribution&&Object.entries(o.ratings.distribution).forEach(([s,t])=>{i+=`Ratings,${s}/10 Stars,${t}
`}),i}escapeCSV(o){return o==null?"":o.includes(",")||o.includes('"')||o.includes(`
`)?`"${o.replace(/"/g,'""')}"`:o}};K(q,"instance");let je=q;const T=je.getInstance(),ce=$(T.isAuthenticated()),Tt=$(!1),Dt=$(null),zt=async(n,o,i)=>{try{await T.logout(),n(!1)}catch(s){console.error("Logout error:",s),i(s instanceof Error?s.message:"Logout failed")}finally{}},Me="https://github.com/iGerman00/traktarr",Et=[{label:"Dashboard",icon:ut,to:"/"},{label:"History",icon:pt,to:"/history"},{label:"Collection",icon:xt,to:"/collection"},{label:"Ratings",icon:ye,to:"/ratings"},{label:"Stats",icon:mt,to:"/stats"},{label:"Export",icon:jt,to:"/export"},{label:"Settings",icon:le,to:"/settings"}];function Rt({children:n,onLogout:o}){const i=Ne(),{colorScheme:s,setColorScheme:t}=Je();return e.jsxs(Z,{padding:"md",navbar:{width:280,breakpoint:"sm",collapsed:{mobile:!0,desktop:!1}},header:{height:60},styles:{main:{background:"var(--mantine-color-body)",minHeight:"100vh",paddingBottom:"2rem"},header:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.05)"},navbar:{boxShadow:"1px 0px 3px rgba(0, 0, 0, 0.05)"}},children:[e.jsx(Z.Header,{children:e.jsxs(C,{h:"100%",px:"md",justify:"space-between",children:[e.jsx(y,{order:3,fw:700,style:{letterSpacing:"-1px"},children:"Traktarr"}),e.jsx(Xe,{variant:"outline",color:s==="dark"?"yellow":"blue",onClick:()=>t(s==="dark"?"light":"dark"),size:"lg","aria-label":"Toggle color scheme",children:s==="dark"?e.jsx(ht,{size:20}):e.jsx(gt,{size:20})})]})}),e.jsxs(Z.Navbar,{p:"md",children:[e.jsx(Z.Section,{grow:!0,component:Ze,children:Et.map(r=>e.jsx(ke,{component:te,to:r.to,label:r.label,leftSection:e.jsx(r.icon,{size:20}),active:i.pathname===r.to,variant:"light",mb:"xs",style:{borderRadius:Ie(8)}},r.label))}),e.jsx(_e,{my:"sm"}),e.jsx(Z.Section,{pb:"md",children:e.jsx(ke,{label:"Logout",leftSection:e.jsx(wt,{size:20}),onClick:o,variant:"subtle",color:"red",style:{borderRadius:Ie(8)}})})]}),e.jsxs(Z.Main,{children:[n,e.jsxs("footer",{style:{width:"100%",textAlign:"center",fontSize:"0.85rem",color:"var(--mantine-color-dimmed, #888)",marginTop:"2rem",padding:"1rem 0 0.5rem 0",opacity:.8},children:["Not affiliated with Trakt or trakt, inc. |"," ",e.jsx("a",{href:Me,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:"GitHub"})]})]})]})}const de=$({type:"all",sortBy:"watched_at",sortOrder:"desc"}),fe=$(null),Fe=$(!1),Be=$(null),Pe=async(n,o,i)=>{o(!0),i(null);try{const s=await T.getStats();n(s)}catch(s){i(s instanceof Error?s.message:"Failed to fetch stats")}finally{o(!1)}},he=$([]),Ue=$(!1),_t=$(null),Oe=$({}),Nt=$(n=>{const o=n(he),i=n(de);return T.applyFilters(o,i)}),Lt=async(n,o,i,s)=>{o(!0);try{const t={page:s==null?void 0:s.page,limit:s==null?void 0:s.limit,type:s==null?void 0:s.type};s!=null&&s.start_at&&(t.startDate=new Date(s.start_at)),s!=null&&s.end_at&&(t.endDate=new Date(s.end_at));const r=await T.getHistory(t);n(r)}catch(t){i(t instanceof Error?t.message:"Failed to fetch history")}finally{o(!1)}},ve=$([]),Mt=$(!1),Ft=$(null);$({});const Bt=$(n=>{const o=n(ve),i=n(de);return T.applyFilters(o,i)}),Re=async(n,o,i,s)=>{o(!0),i(null);try{const t=typeof s=="string"?s:s==null?void 0:s.type;if(!t||t!=="movies"&&t!=="shows")throw new Error('Invalid collection type. Must be "movies" or "shows"');const r=await T.getCollection(t);n(r)}catch(t){i(t instanceof Error?t.message:"Failed to fetch collection")}finally{o(!1)}},Pt=$([]);$(!1);$(null);const be=$([]),Ut=$(!1),Ot=$(null);$({});const Vt=$(n=>{const o=n(be),i=n(de);return T.applyFilters(o,i)}),Ht=async(n,o,i,s)=>{o(!0),i(null);try{const t=await T.getRatings(s);n(t)}catch(t){i(t instanceof Error?t.message:"Failed to fetch ratings")}finally{o(!1)}};function Wt(){const[n,o]=k(fe),[i,s]=k(Fe),[t,r]=k(Be),[a,h]=k(he),[m,f]=k(Ue);return I.useEffect(()=>{Pe(o,s,r),Lt(h,f,()=>{},{limit:5})},[]),e.jsxs(L,{className:"page-container",children:[e.jsx(y,{order:2,mb:"xl",children:"Dashboard"}),e.jsxs(F,{shadow:"sm",p:"xl",mb:"xl",withBorder:!0,className:"data-card",children:[e.jsx(y,{order:3,mb:"md",children:"Your Trakt Stats"}),i?e.jsx(V,{justify:"center",p:"md",children:e.jsx(H,{})}):t?e.jsx(l,{c:"red",children:t}):n?e.jsxs(E,{gutter:"md",children:[e.jsx(E.Col,{span:{base:12,md:4},children:e.jsxs(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,h:"100%",className:"data-card",children:[e.jsx(y,{order:4,mb:"xs",children:"Movies"}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-movies",children:"Watched:"})," ",n.movies.watched]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-movies",children:"Plays:"})," ",n.movies.plays]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-movies",children:"Collected:"})," ",n.movies.collected]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-movies",children:"Ratings:"})," ",n.movies.ratings]})]})}),e.jsx(E.Col,{span:{base:12,md:4},children:e.jsxs(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,h:"100%",className:"data-card",children:[e.jsx(y,{order:4,mb:"xs",children:"Shows"}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-shows",children:"Watched:"})," ",n.shows.watched]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-shows",children:"Collected:"})," ",n.shows.collected]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-shows",children:"Ratings:"})," ",n.shows.ratings]})]})}),e.jsx(E.Col,{span:{base:12,md:4},children:e.jsxs(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,h:"100%",className:"data-card",children:[e.jsx(y,{order:4,mb:"xs",children:"Episodes"}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-shows",children:"Watched:"})," ",n.episodes.watched]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-shows",children:"Plays:"})," ",n.episodes.plays]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-shows",children:"Collected:"})," ",n.episodes.collected]}),e.jsxs(l,{children:[e.jsx(l,{span:!0,fw:700,className:"color-shows",children:"Ratings:"})," ",n.episodes.ratings]})]})})]}):e.jsx(l,{children:"No stats available"})]}),e.jsxs(F,{shadow:"sm",p:"xl",mb:"xl",withBorder:!0,className:"data-card",children:[e.jsx(y,{order:3,mb:"md",children:"Recent Activity"}),m?e.jsx(V,{justify:"center",p:"md",children:e.jsx(H,{})}):a.length>0?e.jsx(Ae,{spacing:"xs",children:a.slice(0,5).map(p=>{var g,d,c;return e.jsxs(Ae.Item,{icon:e.jsx(Qe,{radius:"xl",size:"md",children:p.type==="movie"?e.jsx(W,{size:20}):e.jsx(B,{size:20})}),children:[e.jsx(l,{fw:500,children:p.type==="movie"?((g=p.movie)==null?void 0:g.title)||"Unknown Movie":`${((d=p.show)==null?void 0:d.title)||"Unknown Show"} - ${((c=p.episode)==null?void 0:c.title)||"Unknown Episode"}`}),e.jsx(l,{size:"sm",c:"dimmed",children:new Date(p.watched_at).toLocaleDateString()})]},p.id)})}):e.jsx(l,{children:"No recent activity"})]}),e.jsxs(F,{shadow:"sm",p:"xl",withBorder:!0,children:[e.jsx(y,{order:3,mb:"md",children:"Quick Links"}),e.jsxs(E,{children:[e.jsx(E.Col,{span:{base:12,sm:6,md:3},children:e.jsxs(D,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,className:"data-card",children:[e.jsx(y,{order:4,mb:"xs",children:"History"}),e.jsx(l,{size:"sm",c:"dimmed",mb:"md",children:"View your complete watch history"}),e.jsx(C,{justify:"flex-start",children:e.jsx(U,{component:te,to:"/history",variant:"light",children:"View History"})})]})}),e.jsx(E.Col,{span:{base:12,sm:6,md:3},children:e.jsxs(D,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,className:"data-card",children:[e.jsx(y,{order:4,mb:"xs",children:"Collection"}),e.jsx(l,{size:"sm",c:"dimmed",mb:"md",children:"Browse your collected movies and shows"}),e.jsx(C,{justify:"flex-start",children:e.jsx(U,{component:te,to:"/collection",variant:"light",children:"View Collection"})})]})}),e.jsx(E.Col,{span:{base:12,sm:6,md:3},children:e.jsxs(D,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,className:"data-card",children:[e.jsx(y,{order:4,mb:"xs",children:"Ratings"}),e.jsx(l,{size:"sm",c:"dimmed",mb:"md",children:"See all your ratings"}),e.jsx(C,{justify:"flex-start",children:e.jsx(U,{component:te,to:"/ratings",variant:"light",children:"View Ratings"})})]})}),e.jsx(E.Col,{span:{base:12,sm:6,md:3},children:e.jsxs(D,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,className:"data-card",children:[e.jsx(y,{order:4,mb:"xs",children:"Export"}),e.jsx(l,{size:"sm",c:"dimmed",mb:"md",children:"Export your Trakt data"}),e.jsx(C,{justify:"flex-start",children:e.jsx(U,{component:te,to:"/export",variant:"light",children:"Export Data"})})]})})]})]})]})}function Gt(){const[n]=k(Nt),[o]=k(Oe),i=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=t=>{if(t.type==="movie"&&"movie"in t&&t.movie){const r=t.movie.title,a=t.movie.year,h=t.movie.rating;return e.jsxs("tr",{children:[e.jsx("td",{style:{width:100,padding:"12px"},children:e.jsx("div",{style:{width:100,height:150,borderRadius:8,backgroundColor:"var(--mantine-color-blue-light)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)",transition:"transform 0.2s ease"},className:"data-card",children:e.jsx(W,{size:48,opacity:.8,style:{color:"var(--mantine-color-blue-filled)"}})})}),e.jsx("td",{children:e.jsxs(z,{gap:"sm",children:[e.jsx(y,{order:4,children:r}),e.jsxs(C,{gap:"xs",children:[e.jsx(P,{leftSection:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(W,{size:14})}),color:"blue",variant:"light",size:"lg",children:"Movie"}),a&&e.jsx(P,{color:"gray",variant:"light",size:"lg",children:a})]}),h&&e.jsxs(C,{gap:"xs",align:"center",children:[e.jsx(l,{size:"sm",fw:500,className:"color-movies",children:"Rating:"}),e.jsx(ae,{value:Math.round(h/2),readOnly:!0,fractions:2,size:"md",color:"blue"}),e.jsxs(l,{size:"sm",fw:700,children:["(",h.toFixed(1),")"]})]}),e.jsxs(C,{gap:"xs",align:"center",children:[e.jsx(se,{size:16}),e.jsx(l,{size:"sm",children:i(t.watched_at)})]})]})})]},t.id)}else if(t.type==="episode"&&"show"in t&&"episode"in t&&t.show&&t.episode){const r=`${t.show.title} - ${t.episode.title}`,a=t.show.year,h=t.episode.rating;return e.jsxs("tr",{children:[e.jsx("td",{style:{width:100,padding:"12px"},children:e.jsx("div",{style:{width:100,height:150,borderRadius:8,backgroundColor:"var(--mantine-color-teal-light)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)",transition:"transform 0.2s ease"},className:"data-card",children:e.jsx(B,{size:48,opacity:.8,style:{color:"var(--mantine-color-teal-filled)"}})})}),e.jsx("td",{children:e.jsxs(z,{gap:"sm",children:[e.jsx(y,{order:4,children:r}),e.jsxs(C,{gap:"xs",children:[e.jsx(P,{leftSection:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(B,{size:14})}),color:"teal",variant:"light",size:"lg",children:"TV Show"}),a&&e.jsx(P,{color:"gray",variant:"light",size:"lg",children:a})]}),h&&e.jsxs(C,{gap:"xs",align:"center",children:[e.jsx(l,{size:"sm",fw:500,className:"color-shows",children:"Rating:"}),e.jsx(ae,{value:Math.round(h/2),readOnly:!0,fractions:2,size:"md",color:"teal"}),e.jsxs(l,{size:"sm",fw:700,children:["(",h.toFixed(1),")"]})]}),e.jsxs(C,{gap:"xs",align:"center",children:[e.jsx(se,{size:16}),e.jsx(l,{size:"sm",children:i(t.watched_at)})]})]})})]},t.id)}else return null};return n.length===0?e.jsx(L,{py:"xl",children:e.jsx(ne,{children:e.jsx(l,{size:"lg",fw:500,c:"dimmed",children:"No history items match your filters."})})}):e.jsxs(L,{children:[e.jsxs(l,{size:"sm",mb:"md",fw:500,c:"dimmed",children:["Showing ",n.length," items",o&&Object.keys(o).length>0?" (filtered)":""]}),e.jsx(we,{striped:!0,highlightOnHover:!0,withColumnBorders:!0,withTableBorder:!0,children:e.jsx("tbody",{children:n.map(s)})})]})}function Yt(){const[n,o]=k(he),[i,s]=k(Ue),[t,r]=k(_t),[a,h]=k(Oe),[m,f]=I.useState(1),[p,g]=I.useState(50),[d,c]=I.useState(""),[w,j]=I.useState(null),[S,x]=I.useState(null),[v,u]=I.useState(0),[b,_]=I.useState(0);I.useEffect(()=>{R()},[]),I.useEffect(()=>{(m!==1||p!==50)&&R()},[m,p]),I.useEffect(()=>{f(1),R()},[a]);const R=async()=>{var oe,Se;const N={page:parseInt(String(m),10),limit:parseInt(String(p),10),type:a.type,start_at:(oe=a.startDate)==null?void 0:oe.toISOString(),end_at:(Se=a.endDate)==null?void 0:Se.toISOString()};try{s(!0);const{data:re,headers:Ce}=await T.getHistoryWithHeaders(N);o(re);const He=parseInt(Ce["x-pagination-item-count"]||"0",10),We=parseInt(Ce["x-pagination-page-count"]||"0",10);_(He),u(We),r(null)}catch(re){r(re instanceof Error?re.message:"Failed to fetch history")}finally{s(!1)}},G=()=>{h({type:d||void 0,startDate:w||void 0,endDate:S||void 0}),f(1)},Y=()=>{c(""),j(null),x(null),h({}),f(1),R()},X=N=>{f(N)},A=N=>{N&&(g(Number(N)),f(1))},M=N=>{c(N)};return e.jsxs(L,{className:"page-container",children:[e.jsx(y,{order:2,mb:"xl",children:"Watch History"}),e.jsxs(F,{shadow:"sm",p:"xl",mb:"xl",withBorder:!0,className:"data-card",children:[e.jsx(y,{order:4,mb:"md",children:"Filters"}),e.jsxs(E,{mb:"md",children:[e.jsx(E.Col,{span:{base:12,md:4},children:e.jsx(J,{label:"Type",placeholder:"Select type",value:d,onChange:M,data:[{value:"",label:"All"},{value:"movies",label:"Movies"},{value:"shows",label:"Shows"},{value:"episodes",label:"Episodes"}],clearable:!0})}),e.jsx(E.Col,{span:{base:12,md:4},children:e.jsx($e,{label:"Start Date",placeholder:"Select start date",value:w,onChange:j,clearable:!0})}),e.jsx(E.Col,{span:{base:12,md:4},children:e.jsx($e,{label:"End Date",placeholder:"Select end date",value:S,onChange:x,clearable:!0})})]}),e.jsxs(C,{mb:"md",children:[e.jsx(U,{onClick:G,children:"Apply Filters"}),e.jsx(U,{variant:"outline",onClick:Y,children:"Clear Filters"})]}),Object.keys(a).length>0&&e.jsxs(L,{mb:"lg",children:[e.jsx(y,{order:6,mb:"sm",children:"Active Filters:"}),e.jsxs(C,{children:[a.type&&e.jsxs(P,{color:"red",variant:"light",rightSection:e.jsx(L,{component:"span",style:{cursor:"pointer"},onClick:()=>{h({...a,type:void 0}),c(""),R()},children:"×"}),children:["Type: ",a.type]}),a.startDate&&e.jsxs(P,{color:"indigo",variant:"light",rightSection:e.jsx(L,{component:"span",style:{cursor:"pointer"},onClick:()=>{h({...a,startDate:void 0}),j(null),R()},children:"×"}),children:["From: ",a.startDate.toLocaleDateString()]}),a.endDate&&e.jsxs(P,{color:"indigo",variant:"light",rightSection:e.jsx(L,{component:"span",style:{cursor:"pointer"},onClick:()=>{h({...a,endDate:void 0}),x(null),R()},children:"×"}),children:["To: ",a.endDate.toLocaleDateString()]})]})]})]}),e.jsxs(F,{shadow:"sm",p:"xl",withBorder:!0,className:"data-card",children:[e.jsxs(C,{justify:"space-between",mb:"lg",children:[e.jsx(y,{order:4,children:"Results"}),e.jsx(J,{label:"Items per page",value:String(p),onChange:A,data:[{value:"20",label:"20"},{value:"50",label:"50"},{value:"100",label:"100"},{value:"200",label:"200"}],style:{width:120}})]}),i?e.jsxs(ne,{p:"xl",children:[e.jsx(H,{size:"lg",color:"red",mb:"md"}),e.jsx(l,{children:"Loading history data..."})]}):t?e.jsx(ue,{color:"red",title:"Error",variant:"filled",children:t}):n.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Gt,{}),e.jsx(Ke,{h:"xl"}),e.jsx(ne,{children:e.jsxs(V,{justify:"space-between",align:"center",direction:"column",gap:"md",children:[e.jsx(et,{total:v,value:m,onChange:X,color:"red",radius:"md",withEdges:!0}),e.jsx("div",{style:{marginTop:"10px",textAlign:"center"},children:e.jsxs(l,{size:"xs",c:"dimmed",children:["Total items: ",b||"Unknown"," | Pages: ",v||1," | Items per page: ",p]})})]})})]}):e.jsx(ue,{color:"blue",title:"Info",variant:"light",children:"No history items found."})]})]})}const qt=[{value:"",label:"All Genres"},{value:"action",label:"Action"},{value:"adventure",label:"Adventure"},{value:"animation",label:"Animation"},{value:"comedy",label:"Comedy"},{value:"crime",label:"Crime"},{value:"documentary",label:"Documentary"},{value:"drama",label:"Drama"},{value:"family",label:"Family"},{value:"fantasy",label:"Fantasy"},{value:"history",label:"History"},{value:"horror",label:"Horror"},{value:"music",label:"Music"},{value:"mystery",label:"Mystery"},{value:"romance",label:"Romance"},{value:"science-fiction",label:"Science Fiction"},{value:"thriller",label:"Thriller"},{value:"war",label:"War"},{value:"western",label:"Western"}];function Ve(){const[n,o]=k(de),i=(t,r)=>{o(a=>({...a,[t]:r}))},s=()=>{o({type:"all",sortBy:"watched_at",sortOrder:"desc"})};return e.jsxs(L,{mb:"md",children:[e.jsxs(V,{justify:"space-between",align:"center",mb:"sm",children:[e.jsx(y,{order:4,children:e.jsxs(V,{align:"center",gap:"xs",children:[e.jsx(yt,{size:20}),"Filters"]})}),e.jsx(U,{variant:"subtle",size:"xs",onClick:s,children:"Reset Filters"})]}),e.jsxs(V,{gap:"md",wrap:"wrap",children:[e.jsx(J,{label:"Type",value:n.type||"all",onChange:t=>i("type",t),data:[{value:"all",label:"All Types"},{value:"movies",label:"Movies"},{value:"shows",label:"TV Shows"},{value:"episodes",label:"Episodes"}],style:{width:"150px"}}),e.jsx(J,{label:"Genre",value:n.genre||"",onChange:t=>i("genre",t),data:qt,style:{width:"180px"}}),e.jsx(Te,{label:"Year",value:n.year||void 0,onChange:t=>i("year",t),placeholder:"Any year",min:1900,max:new Date().getFullYear(),style:{width:"120px"},allowDecimal:!1}),e.jsx(Te,{label:"Min Rating",value:n.rating||void 0,onChange:t=>i("rating",t),placeholder:"Any rating",min:1,max:10,style:{width:"120px"},allowDecimal:!1}),e.jsx(pe,{label:"Search",value:n.search||"",onChange:t=>i("search",t.currentTarget.value),placeholder:"Search titles...",leftSection:e.jsx(ft,{size:16}),style:{width:"200px"}}),e.jsxs(C,{children:[e.jsx(J,{label:"Sort By",value:n.sortBy||"watched_at",onChange:t=>i("sortBy",t),data:[{value:"title",label:"Title"},{value:"year",label:"Year"},{value:"rating",label:"Rating"},{value:"watched_at",label:"Watch Date"},{value:"collected_at",label:"Collection Date"}],style:{width:"150px"}}),e.jsx(J,{label:"Sort Order",value:n.sortOrder||"desc",onChange:t=>i("sortOrder",t),data:[{value:"asc",label:"Ascending"},{value:"desc",label:"Descending"}],style:{width:"150px"}})]})]})]})}function Jt(){const[n,o]=k(ve),[i]=k(Bt),[s,t]=k(Mt),[r,a]=k(Ft),[h,m]=I.useState(!1);I.useEffect(()=>{!h&&!s&&!r&&(async()=>{t(!0),a(null);try{let d=[],c=[],w=null,j=null;await Promise.all([Re(S=>{d=S},()=>{},S=>{w=S},{type:"movies"}),Re(S=>{c=S},()=>{},S=>{j=S},{type:"shows"})]),w&&j?(a(`Movies: ${w}; Shows: ${j}`),o([])):w?(a(`Movies: ${w}`),o(c)):j?(a(`Shows: ${j}`),o(d)):(a(null),o([...d,...c]))}catch(d){a(d instanceof Error?d.message:"Failed to fetch collection"),o([])}finally{t(!1),m(!0)}})()},[h,s,r,o,t,a]);const f=g=>new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),p=g=>{var v,u,b,_,R,G,Y,X,A,M;const d="movie"in g,c=d?(v=g.movie)==null?void 0:v.title:(u=g.show)==null?void 0:u.title,w=d?(b=g.movie)==null?void 0:b.year:(_=g.show)==null?void 0:_.year,j=d?(R=g.movie)==null?void 0:R.rating:void 0,S=d?g.collected_at:void 0,x=d?"var(--mantine-color-blue-light)":"var(--mantine-color-teal-light)";return e.jsxs("tr",{children:[e.jsx("td",{style:{width:100,padding:"12px"},children:e.jsx("div",{style:{width:100,height:150,borderRadius:8,backgroundColor:x,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)",transition:"transform 0.2s ease"},className:"data-card",children:d?e.jsx(W,{size:48,opacity:.8,style:{color:"var(--mantine-color-blue-filled)"}}):e.jsx(B,{size:48,opacity:.8,style:{color:"var(--mantine-color-teal-filled)"}})})}),e.jsx("td",{children:e.jsxs(z,{gap:"sm",children:[e.jsx(y,{order:4,children:c}),e.jsxs(C,{gap:"xs",children:[e.jsx(P,{color:d?"blue":"teal",variant:"light",size:"lg",leftSection:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:d?e.jsx(W,{size:14}):e.jsx(B,{size:14})}),children:d?"Movie":"TV Show"}),w&&e.jsx(P,{color:"gray",variant:"light",size:"lg",children:w}),d&&((G=g.movie)==null?void 0:G.genres)&&e.jsx(C,{gap:"xs",children:g.movie.genres.slice(0,3).map(N=>e.jsx(P,{color:"indigo",variant:"light",size:"sm",children:N},N))})]}),j&&e.jsxs(C,{gap:"xs",children:[e.jsx(l,{size:"sm",fw:500,className:"color-movies",children:"Rating:"}),e.jsx(ae,{value:Math.round(j/2),readOnly:!0,fractions:2,color:"blue"}),e.jsxs(l,{size:"sm",fw:700,children:["(",j.toFixed(1),")"]})]}),e.jsxs(C,{gap:"xs",align:"center",children:[e.jsx(se,{size:16,color:"dimmed"}),e.jsxs(l,{size:"sm",c:"dimmed",children:["Collected: ",S?f(S):"Unknown date"]})]}),!d&&e.jsxs(l,{size:"sm",c:"dimmed",children:[((Y=g.seasons)==null?void 0:Y.length)||0," seasons, ",((X=g.seasons)==null?void 0:X.reduce((N,oe)=>N+oe.episodes.length,0))||0," episodes"]})]})})]},d?(A=g.movie)==null?void 0:A.ids.trakt:(M=g.show)==null?void 0:M.ids.trakt)};return s&&n.length===0?e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsxs(z,{align:"center",py:"xl",children:[e.jsx(H,{}),e.jsx(l,{children:"Loading collection..."})]})}):r&&n.length===0?e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(z,{align:"center",py:"xl",children:e.jsxs(l,{color:"red",children:["Error: ",r]})})}):e.jsxs(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(y,{order:3,mb:"md",children:"My Collection"}),e.jsx(Ve,{}),s&&n.length>0&&e.jsx(V,{justify:"center",my:"md",children:e.jsx(H,{size:"sm"})}),i.length===0?e.jsx(l,{ta:"center",py:"xl",children:"No collection items match your filters."}):e.jsxs(e.Fragment,{children:[e.jsxs(l,{size:"sm",mb:"md",fw:500,c:"dimmed",children:["Showing ",i.length," of ",n.length," items"]}),e.jsx(we,{striped:!0,highlightOnHover:!0,withColumnBorders:!0,withTableBorder:!0,children:e.jsx("tbody",{children:i.map(p)})})]})]})}function Xt(){return e.jsxs(L,{className:"page-container",children:[e.jsx(y,{order:2,mb:"xl",children:"My Collection"}),e.jsx(F,{shadow:"sm",p:"xl",withBorder:!0,className:"data-card",children:e.jsx(Jt,{})})]})}function Zt(){const[n,o]=k(be),[i]=k(Vt),[s,t]=k(Ut),[r,a]=k(Ot),[h,m]=I.useState(!1);I.useEffect(()=>{!h&&!s&&!r&&(Ht(o,t,a),m(!0))},[h,s,r,o,t,a]);const f=g=>new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),p=g=>{let d="",c,w=g.type,j="",S="",x=e.jsx(B,{size:48,opacity:.8,style:{color:"var(--mantine-color-indigo-filled)"}}),v="";switch(g.type){case"movie":{const{movie:u}=g;d=u.title,c=u.year,w=`movie-${u.ids.trakt}`,j="var(--mantine-color-blue-light)",S="blue",x=e.jsx(W,{size:48,opacity:.8,style:{color:"var(--mantine-color-blue-filled)"}}),v="Movie";break}case"show":{const{show:u}=g;d=u.title,c=u.year,w=`show-${u.ids.trakt}`,j="var(--mantine-color-teal-light)",S="teal",x=e.jsx(B,{size:48,opacity:.8,style:{color:"var(--mantine-color-teal-filled)"}}),v="TV Show";break}case"season":{const{show:u,season:b}=g;d=`${u.title} - Season ${b.number}`,c=u.year,w=`season-${b.ids.trakt}`,j="var(--mantine-color-cyan-light)",S="cyan",x=e.jsx(B,{size:48,opacity:.8,style:{color:"var(--mantine-color-cyan-filled)"}}),v="Season";break}case"episode":{const{show:u,episode:b}=g;d=`${u.title} - S${b.season}E${b.number} - ${b.title}`,c=u.year,w=`episode-${b.ids.trakt}`,j="var(--mantine-color-indigo-light)",S="indigo",x=e.jsx(B,{size:48,opacity:.8,style:{color:"var(--mantine-color-indigo-filled)"}}),v="Episode";break}}return e.jsxs("tr",{children:[e.jsx("td",{style:{width:100,padding:"12px"},children:e.jsx("div",{style:{width:100,height:150,borderRadius:8,backgroundColor:j,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)",transition:"transform 0.2s ease"},className:"data-card",children:x})}),e.jsx("td",{children:e.jsxs(z,{gap:"sm",children:[e.jsx(y,{order:4,children:d}),e.jsxs(C,{gap:"xs",children:[e.jsx(P,{color:S,variant:"light",size:"lg",leftSection:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:g.type==="movie"?e.jsx(W,{size:14}):e.jsx(B,{size:14})}),children:v}),c&&e.jsx(P,{color:"gray",variant:"light",size:"lg",children:c})]}),e.jsxs(C,{gap:"xs",align:"center",children:[e.jsx(ye,{size:16,color:"yellow"}),e.jsx(l,{size:"sm",fw:500,children:"Your Rating:"}),e.jsx(ae,{value:g.rating/2,readOnly:!0,fractions:2,size:"md"}),e.jsxs(l,{size:"sm",fw:700,children:[g.rating,"/10"]})]}),e.jsxs(C,{gap:"xs",align:"center",children:[e.jsx(se,{size:16,color:"dimmed"}),e.jsxs(l,{size:"sm",c:"dimmed",children:["Rated on: ",f(g.rated_at)]})]})]})})]},w)};return s&&n.length===0?e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsxs(z,{align:"center",py:"xl",children:[e.jsx(H,{}),e.jsx(l,{children:"Loading ratings..."})]})}):r&&n.length===0?e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(z,{align:"center",py:"xl",children:e.jsxs(l,{color:"red",children:["Error: ",r]})})}):e.jsxs(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(y,{order:3,mb:"md",children:"My Ratings"}),e.jsx(Ve,{}),s&&n.length>0&&e.jsx(V,{justify:"center",my:"md",children:e.jsx(H,{size:"sm"})}),i.length===0?e.jsx(l,{ta:"center",py:"xl",children:"No ratings match your filters."}):e.jsxs(e.Fragment,{children:[e.jsxs(l,{size:"sm",mb:"md",fw:500,c:"dimmed",children:["Showing ",i.length," of ",n.length," items"]}),e.jsx(we,{striped:!0,highlightOnHover:!0,withColumnBorders:!0,withTableBorder:!0,children:e.jsx("tbody",{children:i.map(p)})})]})]})}function Qt(){return e.jsxs(L,{className:"page-container",children:[e.jsx(y,{order:2,mb:"xl",children:"My Ratings"}),e.jsx(F,{shadow:"sm",p:"xl",withBorder:!0,className:"data-card",children:e.jsx(Zt,{})})]})}function Kt(){const[n,o]=k(fe),[i,s]=k(Fe),[t,r]=k(Be);I.useEffect(()=>{!n&&!i&&!t&&Pe(o,s,r)},[n,i,t,o,s,r]);const a=x=>{const v=Math.floor(x/60),u=Math.floor(v/24);return u>0?`${u} day${u!==1?"s":""} ${v%24} hr${v%24!==1?"s":""}`:`${v} hour${v!==1?"s":""} ${x%60} min${x%60!==1?"s":""}`};if(i&&!n)return e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsxs(z,{align:"center",py:"xl",children:[e.jsx(H,{}),e.jsx(l,{children:"Loading stats..."})]})});if(t&&!n)return e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(z,{align:"center",py:"xl",children:e.jsxs(l,{color:"red",children:["Error: ",t]})})});if(!n)return e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(l,{ta:"center",children:"No stats available."})});const h=n.movies.watched+n.episodes.watched,m=n.movies.plays+n.episodes.plays,f=n.movies.collected+n.episodes.collected,p=n.movies.ratings+n.shows.ratings+n.seasons.ratings+n.episodes.ratings,g=n.movies.comments+n.shows.comments+n.seasons.comments+n.episodes.comments,d=n.movies.minutes+n.episodes.minutes,c=Math.round(n.movies.watched/h*100)||0,w=100-c,j=Object.values(n.ratings.distribution).reduce((x,v)=>x+v,0),S=Object.entries(n.ratings.distribution).map(([x,v])=>({rating:parseInt(x),count:v,percentage:Math.round(v/j*100)||0})).sort((x,v)=>v.rating-x.rating);return e.jsxs(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(y,{order:3,mb:"md",children:"My Stats"}),e.jsxs(E,{gutter:"md",children:[e.jsx(E.Col,{span:{base:12,md:6},children:e.jsxs(F,{shadow:"xs",p:"md",withBorder:!0,children:[e.jsx(y,{order:4,mb:"md",children:"Watched"}),e.jsxs(V,{gap:"md",direction:{base:"column",sm:"row"},align:"center",children:[e.jsx(tt,{size:150,thickness:16,roundCaps:!0,label:e.jsxs(l,{ta:"center",fw:700,size:"lg",children:[h,e.jsx(l,{size:"xs",children:"Items"})]}),sections:[{value:c,color:"blue"},{value:w,color:"teal"}]}),e.jsxs(z,{gap:"xs",style:{flex:1},children:[e.jsxs(C,{gap:"xs",children:[e.jsx(W,{size:20,color:"blue"}),e.jsxs(l,{children:["Movies: ",n.movies.watched]})]}),e.jsxs(C,{gap:"xs",children:[e.jsx(B,{size:20,color:"teal"}),e.jsxs(l,{children:["Episodes: ",n.episodes.watched]})]}),e.jsxs(C,{gap:"xs",children:[e.jsx(vt,{size:20}),e.jsxs(l,{children:["Total Time: ",a(d)]})]}),e.jsx(C,{gap:"xs",children:e.jsxs(l,{size:"sm",children:["Total Plays: ",m]})})]})]})]})}),e.jsx(E.Col,{span:{base:12,md:6},children:e.jsxs(F,{shadow:"xs",p:"md",withBorder:!0,children:[e.jsx(y,{order:4,mb:"md",children:"Collection"}),e.jsxs(z,{gap:"md",children:[e.jsxs(C,{gap:"xs",children:[e.jsx(W,{size:20,color:"blue"}),e.jsxs(l,{children:["Movies: ",n.movies.collected]})]}),e.jsxs(C,{gap:"xs",children:[e.jsx(B,{size:20,color:"teal"}),e.jsxs(l,{children:["Episodes: ",n.episodes.collected]})]}),e.jsxs(l,{size:"sm",children:["Total Items: ",f]})]})]})}),e.jsx(E.Col,{span:{base:12,md:6},children:e.jsxs(F,{shadow:"xs",p:"md",withBorder:!0,children:[e.jsx(y,{order:4,mb:"md",children:"Ratings"}),e.jsxs(z,{gap:"md",children:[e.jsxs(C,{gap:"xs",children:[e.jsx(ye,{size:20,color:"yellow"}),e.jsxs(l,{children:["Total Ratings: ",p]})]}),e.jsx(z,{gap:"xs",children:S.slice(0,5).map(({rating:x,count:v,percentage:u})=>e.jsxs(C,{gap:"xs",grow:!0,children:[e.jsxs(l,{size:"sm",w:50,children:[x,"/10:"]}),e.jsx(st,{value:u,size:"sm",color:x>=7?"green":x>=4?"yellow":"red"}),e.jsx(l,{size:"sm",w:50,children:v})]},x))})]})]})}),e.jsx(E.Col,{span:{base:12,md:6},children:e.jsxs(F,{shadow:"xs",p:"md",withBorder:!0,children:[e.jsx(y,{order:4,mb:"md",children:"Social"}),e.jsxs(z,{gap:"md",children:[e.jsxs(C,{gap:"xs",children:[e.jsx(ge,{size:20}),e.jsxs(l,{children:["Friends: ",n.network.friends]})]}),e.jsxs(C,{gap:"xs",children:[e.jsx(ge,{size:20}),e.jsxs(l,{children:["Followers: ",n.network.followers]})]}),e.jsxs(C,{gap:"xs",children:[e.jsx(ge,{size:20}),e.jsxs(l,{children:["Following: ",n.network.following]})]}),e.jsxs(C,{gap:"xs",children:[e.jsx(bt,{size:20}),e.jsxs(l,{children:["Comments: ",g]})]})]})]})})]})]})}function es(){return e.jsxs(L,{className:"page-container",children:[e.jsx(y,{order:2,mb:"xl",children:"My Statistics"}),e.jsx(F,{shadow:"sm",p:"xl",withBorder:!0,className:"data-card",children:e.jsx(Kt,{})})]})}function ts(){const[n]=k(he),[o]=k(Pt),[i]=k(be),[s]=k(ve),[t]=k(fe),[r,a]=I.useState(!1),[h,m]=I.useState(!1),[f,p]=I.useState(null),[g,d]=I.useState(null),[c,w]=I.useState({format:"json",includeHistory:!0,includeWatched:!0,includeRatings:!0,includeCollection:!0,includeStats:!0,separateFiles:!0}),[j,S]=I.useState([null,null]),x=(u,b)=>{w(_=>({..._,[u]:b}))},v=async()=>{m(!0),p(null),d(null);try{a(!0);const u=c.format==="csv",b={};if(c.includeHistory)if(u||n.length===0)try{let A,M;j[0]&&(A=j[0].toISOString()),j[1]&&(M=j[1].toISOString());const N=await T.getAllHistory({start_at:A,end_at:M});b.history=N}catch(A){console.warn("Could not fetch complete history data:",A),n.length>0&&(b.history=n)}else b.history=n;if(c.includeWatched)try{const A=await T.getWatched("movies"),M=await T.getWatched("shows");c.format==="csv"?(b.watchedMovies=A,b.watchedShows=M):b.watched=[...A,...M]}catch(A){console.warn("Could not fetch watched data:",A),o.length>0&&(b.watched=o)}if(c.includeRatings)if(u||i.length===0)try{const A=await T.getRatings();b.ratings=A}catch(A){console.warn("Could not fetch ratings data:",A),i.length>0&&(b.ratings=i)}else b.ratings=i;if(c.includeCollection)try{const A=await T.getCollection("movies"),M=await T.getCollection("shows");c.format==="csv"?(b.collectionMovies=A,b.collectionShows=M):b.collection=[...A,...M]}catch(A){console.warn("Could not fetch collection data:",A),s.length>0&&(b.collection=s)}if(c.includeStats)if(u||!t)try{const A=await T.getStats();b.stats=A}catch(A){console.warn("Could not fetch stats data:",A),t&&(b.stats=t)}else b.stats=t;const[_,R]=j;(_||R)&&(b.dateRange={startDate:_==null?void 0:_.toISOString(),endDate:R==null?void 0:R.toISOString()});const Y=`trakt-export-${new Date().toISOString().split("T")[0]}`;await T.exportData(b,c.format,Y);const X=c.format==="csv"?"CSV files":`${Y}.${c.format}`;d(`Data successfully exported as ${X}`)}catch(u){console.error("Export error:",u),p(u instanceof Error?u.message:"Export failed")}finally{m(!1),a(!1)}};return e.jsxs(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(y,{order:3,mb:"md",children:"Export Data"}),e.jsxs(z,{gap:"md",children:[e.jsx(J,{label:"Export Format",description:"Choose the format for your exported data",value:c.format,onChange:u=>x("format",u),data:[{value:"json",label:"JSON (Complete Data)"},{value:"csv",label:"CSV (Spreadsheet)"}]}),e.jsx(y,{order:5,mt:"xs",children:"Data to Include"}),e.jsx(ee,{label:"Watch History",description:n.length>0?`${n.length} items loaded`:"Will fetch from Trakt",checked:c.includeHistory,onChange:u=>x("includeHistory",u.currentTarget.checked)}),e.jsx(ee,{label:"Watched Items",description:o.length>0?`${o.length} items loaded`:"Will fetch from Trakt",checked:c.includeWatched,onChange:u=>x("includeWatched",u.currentTarget.checked)}),e.jsx(ee,{label:"Ratings",description:i.length>0?`${i.length} items loaded`:"Will fetch from Trakt",checked:c.includeRatings,onChange:u=>x("includeRatings",u.currentTarget.checked)}),e.jsx(ee,{label:"Collection",description:s.length>0?`${s.length} items loaded`:"Will fetch from Trakt",checked:c.includeCollection,onChange:u=>x("includeCollection",u.currentTarget.checked)}),e.jsx(ee,{label:"Stats",description:t?"User statistics loaded":"Will fetch from Trakt",checked:c.includeStats,onChange:u=>x("includeStats",u.currentTarget.checked)}),e.jsx(y,{order:5,mt:"xs",children:"Date Range (Optional)"}),e.jsx(l,{size:"sm",c:"dimmed",children:"Filter history items by date range"}),e.jsx(ot,{type:"range",label:"Date Range",placeholder:"Pick date range",value:j,onChange:S,leftSection:e.jsx(se,{size:16}),clearable:!0}),f&&e.jsx(l,{color:"red",size:"sm",children:f}),g&&e.jsx(l,{color:"green",size:"sm",children:g}),e.jsx(V,{justify:"center",mt:"md",children:e.jsx(U,{leftSection:h?e.jsx(H,{size:"xs"}):e.jsx(St,{size:16}),onClick:v,color:"red",size:"md",disabled:h||!c.includeHistory&&!c.includeWatched&&!c.includeRatings&&!c.includeCollection&&!c.includeStats,children:h?r?"Fetching data...":"Exporting...":"Export Data"})})]})]})}function ss(){return e.jsxs(L,{className:"page-container",children:[e.jsx(y,{order:2,mb:"xl",children:"Export Your Data"}),e.jsx(F,{shadow:"sm",p:"xl",withBorder:!0,className:"data-card",children:e.jsx(ts,{})})]})}function os(){const[n,o]=I.useState(""),[i,s]=I.useState(""),[t,r]=I.useState(""),[a]=k(ce),[h,m]=I.useState(!1);I.useEffect(()=>{const p=T.getCredentials();p&&(o(p.clientId||""),s(p.clientSecret||""),r(p.redirectUri||""))},[]);const f=()=>{if(!n.trim()){ie.show({title:"Error",message:"Client ID is required",color:"red"});return}if(!i.trim()){ie.show({title:"Error",message:"Client Secret is required",color:"red"});return}if(!t.trim()){ie.show({title:"Error",message:"Redirect URI is required",color:"red"});return}T.saveCredentials({clientId:n,clientSecret:i,redirectUri:t}),ie.show({title:"Success",message:"Trakt API credentials saved successfully. Go back to the home page to log in and start using the app.",color:"green"}),m(!0),a&&T.logout()};return e.jsxs(xe,{size:"md",className:"page-container",children:[e.jsx(y,{order:2,mb:"xl",children:e.jsxs(C,{gap:"xs",children:[e.jsx(le,{size:24}),e.jsx("span",{children:"Settings"})]})}),e.jsx(D,{shadow:"sm",padding:"xl",radius:"md",withBorder:!0,mb:"xl",className:"data-card",children:e.jsxs(z,{children:[e.jsx(y,{order:3,children:"Trakt API Credentials"}),e.jsx(l,{size:"sm",c:"dimmed",children:"To use this app, you need to provide your own Trakt API credentials. These credentials are stored locally in your browser and are never sent to any server other than Trakt."}),e.jsx(_e,{my:"sm"}),e.jsxs(L,{children:[e.jsx(pe,{label:"Client ID",placeholder:"Your Trakt API Client ID",value:n,onChange:p=>o(p.target.value),required:!0,mb:"md"}),e.jsx(rt,{label:"Client Secret",placeholder:"Your Trakt API Client Secret",value:i,onChange:p=>s(p.target.value),required:!0,mb:"md"}),e.jsx(pe,{label:"Redirect URI",placeholder:"Your Trakt API Redirect URI",value:t,onChange:p=>r(p.target.value),required:!0,mb:"md",description:"Set this to the URL where this app is running, ending with /auth. For example: "+window.location.origin+"/auth"})]}),e.jsx(C,{justify:"space-between",children:e.jsx(U,{onClick:f,color:"red",size:"md",leftSection:h?e.jsx(Le,{size:16}):void 0,children:h?"Saved":"Save Credentials"})})]})}),e.jsx(D,{shadow:"sm",padding:"xl",radius:"md",withBorder:!0,className:"data-card",children:e.jsxs(z,{children:[e.jsx(y,{order:3,children:"How to Create a Trakt Application"}),e.jsxs(D,{withBorder:!0,p:"md",bg:"var(--mantine-color-gray-light)",children:[e.jsx(y,{order:5,mb:"sm",c:"red",fw:700,children:"Important Notes"}),e.jsxs("ul",{style:{paddingLeft:"20px",margin:0},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Redirect URIs:"})," You ",e.jsx("u",{children:"must"})," add the URL where this app is running, ending with ",e.jsx("code",{children:"/auth"})," (e.g., ",e.jsxs("code",{children:[window.location.origin,"/auth"]}),"), as the Redirect URI in your Trakt application."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CORS Issues:"})," If you are a developer, authentication may not work on localhost due to CORS restrictions. If you encounter issues, try using a browser extension that disables CORS or deploy to a proper domain."]})]})]}),e.jsxs("ol",{style:{paddingLeft:"20px"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Go to Trakt API Applications:"}),e.jsx("br",{}),"Visit ",e.jsx("a",{href:"https://trakt.tv/oauth/applications",target:"_blank",rel:"noopener noreferrer",children:"Trakt API Applications"})," and sign in"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Create New Application:"}),e.jsx("br",{}),'Click the "New Application" button']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Fill in the application details:"}),e.jsxs("ul",{style:{paddingLeft:"20px"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Name:"})," Traktarr (or any name)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Description:"})," Personal app for exporting my Trakt data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Redirect URI:"})," Add ",e.jsxs("code",{children:[window.location.origin,"/auth"]})," (or your deployed URL ending with ",e.jsx("code",{children:"/auth"}),")"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"JavaScript Origins:"})," ",e.jsx("code",{children:window.location.origin})]})]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:'Click "Save App"'})," at the bottom of the form"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Copy credentials:"})," Copy the Client ID and Client Secret to the form above"]})]})]})})]})}const rs="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20id='Layer_2'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%2048%2048'%3e%3cdefs%3e%3cstyle%3e%20.cls-1%20{%20fill:%20%23fff;%20}%20.cls-2%20{%20fill:%20url(%23New_Gradient_Swatch_2);%20}%20%3c/style%3e%3cradialGradient%20id='New_Gradient_Swatch_2'%20data-name='New%20Gradient%20Swatch%202'%20cx='48.06'%20cy='-.12'%20fx='48.06'%20fy='-.12'%20r='58.11'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%239f42c6'/%3e%3cstop%20offset='.27'%20stop-color='%23a041c3'/%3e%3cstop%20offset='.42'%20stop-color='%23a43ebb'/%3e%3cstop%20offset='.53'%20stop-color='%23aa39ad'/%3e%3cstop%20offset='.64'%20stop-color='%23b4339a'/%3e%3cstop%20offset='.73'%20stop-color='%23c02b81'/%3e%3cstop%20offset='.82'%20stop-color='%23cf2061'/%3e%3cstop%20offset='.9'%20stop-color='%23e1143c'/%3e%3cstop%20offset='.97'%20stop-color='%23f50613'/%3e%3cstop%20offset='1'%20stop-color='red'/%3e%3c/radialGradient%3e%3c/defs%3e%3cg%20id='_x2D_-production'%3e%3cg%20id='logomark.circle.gradient'%3e%3cpath%20id='background'%20class='cls-2'%20d='M48,24c0,6.62-2.69,12.62-7.03,16.97-4.34,4.34-10.34,7.03-16.97,7.03C10.75,48,0,37.25,0,24c0-6.63,2.69-12.63,7.03-16.97C11.37,2.68,17.37,0,24,0s12.63,2.68,16.97,7.03c.14.14.27.28.4.42.48.5.94,1.02,1.37,1.56.21.26.41.52.6.79.43.57.82,1.16,1.18,1.76.18.29.35.58.51.87.35.64.68,1.29.96,1.97,1.3,2.94,2.01,6.18,2.01,9.6Z'/%3e%3cg%20id='checkbox'%3e%3cpath%20class='cls-1'%20d='M12.93,18.67l-1.47,1.46,14.4,14.4,1.47-1.47-4.32-4.31,19.73-19.74c-.43-.54-.89-1.06-1.37-1.56l-19.83,19.83-8.61-8.61ZM30.18,30.21l15.81-15.81c-.28-.68-.61-1.33-.96-1.97l-16.32,16.32,1.47,1.46ZM28.02,32.37l1.46-1.46-2.15-2.16,17.19-17.19c-.36-.6-.75-1.19-1.18-1.76l-18.94,18.95,3.62,3.62ZM13.62,17.97l7.92,7.92,1.47-1.47-7.92-7.92-1.47,1.47ZM25.17,22.27l-7.92-7.92-1.47,1.47,7.92,7.92,1.47-1.47ZM24,41.32c-9.55,0-17.32-7.77-17.32-17.32S14.45,6.67,24,6.67c2.6,0,5.11.56,7.44,1.68l.89-1.87c-2.61-1.25-5.42-1.88-8.33-1.88C13.31,4.6,4.61,13.3,4.61,24s8.7,19.4,19.4,19.4c7.64,0,14.59-4.51,17.71-11.48l-1.89-.85c-2.79,6.23-9,10.26-15.82,10.26Z'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e";function is(n,o){return new URLSearchParams(n).get(o)}function ns(){const n=ct(),o=Ne(),[i,s]=k(ce),[t,r]=k(Tt),[a,h]=k(Dt),[m,f]=I.useState(!1),[p,g]=I.useState(!1);I.useEffect(()=>{f(T.hasValidCredentials())},[]),I.useEffect(()=>{const c=is(o.search,"code");c&&(r(!0),h(null),T.handleAuthCallback(c).then(()=>{s(!0),g(!0),setTimeout(()=>{n("/",{replace:!0})},1200)}).catch(w=>{h(w instanceof Error?w.message:"Authentication failed")}).finally(()=>{r(!1)}))},[o.search]);const d=()=>{if(!m){n("/settings");return}const c=T.getAuthorizationUrl();window.location.href=c};return i||p?e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsxs(z,{align:"center",gap:"md",children:[e.jsx(Le,{size:48,color:"green"}),e.jsx(y,{order:3,children:"Successfully Authenticated"}),e.jsx(l,{children:"You are now connected to Trakt"})]})}):e.jsxs(xe,{size:"xs",py:"xl",children:[e.jsx(y,{order:2,ta:"center",mb:"md",fw:700,style:{letterSpacing:"-1px"},children:"Traktarr"}),e.jsxs(xe,{size:"sm",children:[e.jsx(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsxs(z,{align:"center",gap:"md",children:[e.jsx("img",{src:rs,alt:"Trakt",width:48}),e.jsx(y,{order:3,children:"Connect to Trakt"}),m?e.jsxs(e.Fragment,{children:[e.jsx(l,{children:"To export your Trakt data, you need to authorize this application. Click the button below to start the authentication process."}),e.jsx(U,{onClick:d,loading:t,color:"red",children:"Connect to Trakt"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"API Credentials Required",color:"yellow",icon:e.jsx(le,{size:16}),children:"Before connecting to Trakt, you need to set up your API credentials. Please go to the Settings page to enter your Trakt API credentials, then return here to connect."}),e.jsx(U,{onClick:()=>n("/settings"),color:"yellow",leftSection:e.jsx(le,{size:16}),children:"Go to Settings"})]}),t&&e.jsx(ne,{children:e.jsx(H,{color:"red"})}),a&&e.jsxs(l,{color:"red",size:"sm",children:["Error: ",a]})]})}),e.jsxs("footer",{style:{width:"100%",textAlign:"center",fontSize:"0.85rem",color:"var(--mantine-color-dimmed, #888)",marginTop:"2rem",padding:"1rem 0 0.5rem 0",opacity:.8},children:["Not affiliated with Trakt or trakt, inc. |"," ",e.jsx("a",{href:Me,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:"GitHub"})]})]})]})}const as=()=>e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",padding:"20px"},children:e.jsx(ns,{})}),Q=({children:n})=>{const[o]=k(ce);return o?e.jsx(e.Fragment,{children:n}):e.jsx(me,{to:"/auth",replace:!0})},ls=nt({primaryColor:"red",defaultRadius:"md",components:{Button:{defaultProps:{color:"red"}}}});function cs(){const[n,o]=k(ce);I.useEffect(()=>{},[]);const i=()=>{zt(o,()=>{},()=>{})};return e.jsxs(it,{theme:ls,defaultColorScheme:"auto",children:[e.jsx(at,{}),e.jsx(dt,{children:e.jsxs(Ee,{children:[e.jsx(O,{path:"/auth",element:n?e.jsx(me,{to:"/",replace:!0}):e.jsx(as,{})}),e.jsx(O,{path:"*",element:e.jsx(Rt,{onLogout:i,children:e.jsxs(Ee,{children:[e.jsx(O,{path:"/",element:e.jsx(Q,{children:e.jsx(Wt,{})})}),e.jsx(O,{path:"/history",element:e.jsx(Q,{children:e.jsx(Yt,{})})}),e.jsx(O,{path:"/collection",element:e.jsx(Q,{children:e.jsx(Xt,{})})}),e.jsx(O,{path:"/ratings",element:e.jsx(Q,{children:e.jsx(Qt,{})})}),e.jsx(O,{path:"/stats",element:e.jsx(Q,{children:e.jsx(es,{})})}),e.jsx(O,{path:"/export",element:e.jsx(Q,{children:e.jsx(ss,{})})}),e.jsx(O,{path:"/settings",element:e.jsx(os,{})}),e.jsx(O,{path:"*",element:e.jsx(me,{to:"/",replace:!0})})]})})})]})})]})}qe.createRoot(document.getElementById("root")).render(e.jsx(I.StrictMode,{children:e.jsx(cs,{})}));
